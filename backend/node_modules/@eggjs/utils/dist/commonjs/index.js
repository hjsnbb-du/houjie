"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EggType = exports.getFrameworkOrEggPath = exports.getLoadUnits = exports.getConfig = exports.getPlugins = exports.getFrameworkPath = void 0;
exports.detectType = detectType;
const node_path_1 = __importDefault(require("node:path"));
const promises_1 = __importDefault(require("node:fs/promises"));
const framework_js_1 = require("./framework.js");
const plugin_js_1 = require("./plugin.js");
const deprecated_js_1 = require("./deprecated.js");
// support import { getFrameworkPath } from '@eggjs/utils'
var framework_js_2 = require("./framework.js");
Object.defineProperty(exports, "getFrameworkPath", { enumerable: true, get: function () { return framework_js_2.getFrameworkPath; } });
var plugin_js_2 = require("./plugin.js");
Object.defineProperty(exports, "getPlugins", { enumerable: true, get: function () { return plugin_js_2.getPlugins; } });
Object.defineProperty(exports, "getConfig", { enumerable: true, get: function () { return plugin_js_2.getConfig; } });
Object.defineProperty(exports, "getLoadUnits", { enumerable: true, get: function () { return plugin_js_2.getLoadUnits; } });
var deprecated_js_2 = require("./deprecated.js");
Object.defineProperty(exports, "getFrameworkOrEggPath", { enumerable: true, get: function () { return deprecated_js_2.getFrameworkOrEggPath; } });
__exportStar(require("./import.js"), exports);
__exportStar(require("./error/index.js"), exports);
// support import utils from '@eggjs/utils'
exports.default = {
    getFrameworkPath: framework_js_1.getFrameworkPath,
    getPlugins: plugin_js_1.getPlugins, getConfig: plugin_js_1.getConfig, getLoadUnits: plugin_js_1.getLoadUnits,
    getFrameworkOrEggPath: deprecated_js_1.getFrameworkOrEggPath,
};
var EggType;
(function (EggType) {
    EggType["framework"] = "framework";
    EggType["plugin"] = "plugin";
    EggType["application"] = "application";
    EggType["unknown"] = "unknown";
})(EggType || (exports.EggType = EggType = {}));
/**
 * Detect the type of egg project
 */
async function detectType(baseDir) {
    const pkgFile = node_path_1.default.join(baseDir, 'package.json');
    let pkg;
    try {
        await promises_1.default.access(pkgFile);
    }
    catch {
        return EggType.unknown;
    }
    try {
        pkg = JSON.parse(await promises_1.default.readFile(pkgFile, 'utf-8'));
    }
    catch {
        return EggType.unknown;
    }
    if (pkg.egg?.framework) {
        return EggType.framework;
    }
    if (pkg.eggPlugin?.name) {
        return EggType.plugin;
    }
    return EggType.application;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4QkEsZ0NBMkJDO0FBekRELDBEQUE2QjtBQUM3QixnRUFBa0M7QUFDbEMsaURBQWtEO0FBQ2xELDJDQUFrRTtBQUNsRSxtREFBd0Q7QUFFeEQsMERBQTBEO0FBQzFELCtDQUFrRDtBQUF6QyxnSEFBQSxnQkFBZ0IsT0FBQTtBQUN6Qix5Q0FBa0U7QUFBekQsdUdBQUEsVUFBVSxPQUFBO0FBQUUsc0dBQUEsU0FBUyxPQUFBO0FBQUUseUdBQUEsWUFBWSxPQUFBO0FBQzVDLGlEQUF3RDtBQUEvQyxzSEFBQSxxQkFBcUIsT0FBQTtBQUM5Qiw4Q0FBNEI7QUFDNUIsbURBQWlDO0FBRWpDLDJDQUEyQztBQUMzQyxrQkFBZTtJQUNiLGdCQUFnQixFQUFoQiwrQkFBZ0I7SUFDaEIsVUFBVSxFQUFWLHNCQUFVLEVBQUUsU0FBUyxFQUFULHFCQUFTLEVBQUUsWUFBWSxFQUFaLHdCQUFZO0lBQ25DLHFCQUFxQixFQUFyQixxQ0FBcUI7Q0FDdEIsQ0FBQztBQUVGLElBQVksT0FLWDtBQUxELFdBQVksT0FBTztJQUNqQixrQ0FBdUIsQ0FBQTtJQUN2Qiw0QkFBaUIsQ0FBQTtJQUNqQixzQ0FBMkIsQ0FBQTtJQUMzQiw4QkFBbUIsQ0FBQTtBQUNyQixDQUFDLEVBTFcsT0FBTyx1QkFBUCxPQUFPLFFBS2xCO0FBRUQ7O0dBRUc7QUFDSSxLQUFLLFVBQVUsVUFBVSxDQUFDLE9BQWU7SUFDOUMsTUFBTSxPQUFPLEdBQUcsbUJBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ25ELElBQUksR0FPSCxDQUFDO0lBQ0YsSUFBSSxDQUFDO1FBQ0gsTUFBTSxrQkFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBQUMsTUFBTSxDQUFDO1FBQ1AsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFDRCxJQUFJLENBQUM7UUFDSCxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLGtCQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFBQyxNQUFNLENBQUM7UUFDUCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUM7SUFDekIsQ0FBQztJQUNELElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxTQUFTLEVBQUUsQ0FBQztRQUN2QixPQUFPLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDM0IsQ0FBQztJQUNELElBQUksR0FBRyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUN4QixPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUM7SUFDeEIsQ0FBQztJQUNELE9BQU8sT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUM3QixDQUFDIn0=