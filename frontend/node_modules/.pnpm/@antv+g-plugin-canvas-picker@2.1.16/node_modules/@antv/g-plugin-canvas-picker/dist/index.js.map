{"version":3,"file":"index.js","sources":["../src/CanvasPickerPlugin.ts","../src/Circle.ts","../src/Ellipse.ts","../src/utils/math.ts","../src/Line.ts","../src/Path.ts","../src/Polygon.ts","../src/Polyline.ts","../src/Rect.ts","../src/Image.ts","../src/Text.ts","../src/index.ts"],"sourcesContent":["import type {\n  BaseStyleProps,\n  DisplayObject,\n  PickingResult,\n  RenderingPlugin,\n  Shape,\n  IDocument,\n  RenderingPluginContext,\n  GlobalRuntime,\n} from '@antv/g-lite';\nimport { findClosestClipPathTarget, Point } from '@antv/g-lite';\nimport type { PathGenerator } from '@antv/g-plugin-canvas-path-generator';\nimport { mat4, vec3 } from 'gl-matrix';\n\nexport type PointInPathPicker<T extends BaseStyleProps> = (\n  displayObject: DisplayObject<T>,\n  point: Point,\n  isClipPath: boolean,\n  isPointInPath: (displayObject: DisplayObject<T>, point: Point) => boolean,\n  context: RenderingPluginContext,\n  runtime: GlobalRuntime,\n) => boolean;\n\nconst tmpVec3a = vec3.create();\nconst tmpVec3b = vec3.create();\nconst tmpVec3c = vec3.create();\nconst tmpMat4 = mat4.create();\n\ninterface Extended {\n  pathGeneratorFactory: Record<Shape, PathGenerator<any>>;\n  pointInPathPickerFactory: Record<Shape, PointInPathPicker<any>>;\n}\n\n/**\n * pick shape(s) with Mouse/Touch event\n *\n * 1. find AABB with r-tree\n * 2. do math calculation with geometry in an accurate way\n */\nexport class CanvasPickerPlugin implements RenderingPlugin {\n  static tag = 'CanvasPicker';\n\n  private context: RenderingPluginContext & Extended;\n  private runtime: GlobalRuntime;\n\n  apply(context: RenderingPluginContext, runtime: GlobalRuntime) {\n    const { renderingService, renderingContext } = context;\n    this.context = context as RenderingPluginContext & Extended;\n    this.runtime = runtime;\n\n    const document = renderingContext.root?.ownerDocument;\n\n    renderingService.hooks.pick.tapPromise(\n      CanvasPickerPlugin.tag,\n      async (result: PickingResult) => {\n        return this.pick(document, result);\n      },\n    );\n\n    renderingService.hooks.pickSync.tap(\n      CanvasPickerPlugin.tag,\n      (result: PickingResult) => {\n        return this.pick(document, result);\n      },\n    );\n  }\n\n  private pick(document: IDocument, result: PickingResult) {\n    const {\n      topmost,\n      position: { x, y },\n    } = result;\n\n    // position in world space\n    const position = vec3.set(tmpVec3a, x, y, 0);\n\n    // query by AABB first with spatial index(r-tree)\n    const hitTestList = document.elementsFromBBox(\n      position[0],\n      position[1],\n      position[0],\n      position[1],\n    );\n\n    // test with clip path & origin shape\n    // @see https://github.com/antvis/g/issues/1064\n    const pickedDisplayObjects: DisplayObject[] = [];\n    for (const displayObject of hitTestList) {\n      const worldTransform = displayObject.getWorldTransform();\n      const isHitOriginShape = this.isHit(\n        displayObject,\n        position,\n        worldTransform,\n        false,\n      );\n      if (isHitOriginShape) {\n        // should look up in the ancestor node\n        const clipped = findClosestClipPathTarget(displayObject);\n        if (clipped) {\n          const { clipPath } = clipped.parsedStyle;\n          const isHitClipPath = this.isHit(\n            clipPath,\n            position,\n            clipPath.getWorldTransform(),\n            true,\n          );\n          if (isHitClipPath) {\n            if (topmost) {\n              result.picked = [displayObject];\n              return result;\n            }\n            pickedDisplayObjects.push(displayObject);\n          }\n        } else {\n          if (topmost) {\n            result.picked = [displayObject];\n            return result;\n          }\n          pickedDisplayObjects.push(displayObject);\n        }\n      }\n    }\n\n    result.picked = pickedDisplayObjects;\n    return result;\n  }\n\n  private isHit = (\n    displayObject: DisplayObject,\n    position: vec3,\n    worldTransform: mat4,\n    isClipPath: boolean,\n  ) => {\n    // use picker for current shape's type\n    const pick =\n      this.context.pointInPathPickerFactory[displayObject.nodeName as Shape];\n    if (pick) {\n      // invert with world matrix\n      const invertWorldMat = mat4.invert(tmpMat4, worldTransform);\n\n      // transform client position to local space, do picking in local space\n      const localPosition = vec3.transformMat4(\n        tmpVec3b,\n        vec3.set(tmpVec3c, position[0], position[1], 0),\n        invertWorldMat,\n      );\n\n      if (\n        pick(\n          displayObject,\n          new Point(localPosition[0], localPosition[1]),\n          isClipPath,\n          this.isPointInPath,\n          this.context,\n          this.runtime,\n        )\n      ) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  /**\n   * use native picking method\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/isPointInPath\n   */\n  private isPointInPath = (displayObject: DisplayObject, position: Point) => {\n    const context = this.runtime.offscreenCanvasCreator.getOrCreateContext(\n      this.context.config.offscreenCanvas,\n    ) as CanvasRenderingContext2D;\n\n    const generatePath =\n      this.context.pathGeneratorFactory[displayObject.nodeName];\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, displayObject.parsedStyle);\n      context.closePath();\n    }\n\n    return context.isPointInPath(position.x, position.y);\n  };\n}\n","import type {\n  CircleStyleProps,\n  DisplayObject,\n  ParsedCircleStyleProps,\n  Point,\n} from '@antv/g-lite';\nimport { isFillOrStrokeAffected } from '@antv/g-lite';\nimport { distance } from '@antv/g-math';\n\nexport function isPointInPath(\n  displayObject: DisplayObject<CircleStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n): boolean {\n  const {\n    cx = 0,\n    cy = 0,\n    r,\n    fill,\n    stroke,\n    lineWidth = 1,\n    increasedLineWidthForHitTesting = 0,\n    pointerEvents = 'auto',\n  } = displayObject.parsedStyle as ParsedCircleStyleProps;\n  const halfLineWidth = (lineWidth + increasedLineWidthForHitTesting) / 2;\n  const absDistance = distance(cx, cy, position.x, position.y);\n\n  const [hasFill, hasStroke] = isFillOrStrokeAffected(\n    pointerEvents,\n    fill,\n    stroke,\n  );\n\n  if ((hasFill && hasStroke) || isClipPath) {\n    return absDistance <= r + halfLineWidth;\n  }\n  if (hasFill) {\n    return absDistance <= r;\n  }\n  if (hasStroke) {\n    return absDistance >= r - halfLineWidth && absDistance <= r + halfLineWidth;\n  }\n  return false;\n}\n","import type {\n  DisplayObject,\n  EllipseStyleProps,\n  ParsedEllipseStyleProps,\n  Point,\n} from '@antv/g-lite';\nimport { isFillOrStrokeAffected } from '@antv/g-lite';\n\nfunction ellipseDistance(\n  squareX: number,\n  squareY: number,\n  rx: number,\n  ry: number,\n) {\n  return squareX / (rx * rx) + squareY / (ry * ry);\n}\n\nexport function isPointInPath(\n  displayObject: DisplayObject<EllipseStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n): boolean {\n  const {\n    cx = 0,\n    cy = 0,\n    rx,\n    ry,\n    fill,\n    stroke,\n    lineWidth = 1,\n    increasedLineWidthForHitTesting = 0,\n    pointerEvents = 'auto',\n  } = displayObject.parsedStyle as ParsedEllipseStyleProps;\n\n  const { x, y } = position;\n  const [hasFill, hasStroke] = isFillOrStrokeAffected(\n    pointerEvents,\n    fill,\n    stroke,\n  );\n\n  const halfLineWith = (lineWidth + increasedLineWidthForHitTesting) / 2;\n  const squareX = (x - cx) * (x - cx);\n  const squareY = (y - cy) * (y - cy);\n  // 使用椭圆的公式： x*x/rx*rx + y*y/ry*ry = 1;\n  if ((hasFill && hasStroke) || isClipPath) {\n    return (\n      ellipseDistance(squareX, squareY, rx + halfLineWith, ry + halfLineWith) <=\n      1\n    );\n  }\n  if (hasFill) {\n    return ellipseDistance(squareX, squareY, rx, ry) <= 1;\n  }\n  if (hasStroke) {\n    return (\n      ellipseDistance(squareX, squareY, rx - halfLineWith, ry - halfLineWith) >=\n        1 &&\n      ellipseDistance(squareX, squareY, rx + halfLineWith, ry + halfLineWith) <=\n        1\n    );\n  }\n  return false;\n}\n","import { distance, linePointToLine } from '@antv/g-math';\n\nexport function inBox(\n  minX: number,\n  minY: number,\n  width: number,\n  height: number,\n  x: number,\n  y: number,\n) {\n  return x >= minX && x <= minX + width && y >= minY && y <= minY + height;\n}\n\nexport function inRect(\n  minX: number,\n  minY: number,\n  width: number,\n  height: number,\n  lineWidth: number,\n  x: number,\n  y: number,\n) {\n  const halfWidth = lineWidth / 2;\n  // 将四个边看做矩形来检测，比边的检测算法要快\n  return (\n    inBox(minX - halfWidth, minY - halfWidth, width, lineWidth, x, y) || // 上边\n    inBox(\n      minX + width - halfWidth,\n      minY - halfWidth,\n      lineWidth,\n      height,\n      x,\n      y,\n    ) || // 右边\n    inBox(\n      minX + halfWidth,\n      minY + height - halfWidth,\n      width,\n      lineWidth,\n      x,\n      y,\n    ) || // 下边\n    inBox(minX - halfWidth, minY + halfWidth, lineWidth, height, x, y)\n  ); // 左边\n}\n\nexport function inArc(\n  cx: number,\n  cy: number,\n  r: number,\n  startAngle: number,\n  endAngle: number,\n  lineWidth: number,\n  x: number,\n  y: number,\n) {\n  const angle = (Math.atan2(y - cy, x - cx) + Math.PI * 2) % (Math.PI * 2); // 转换到 0 - 2 * Math.PI 之间\n  // if (angle < startAngle || angle > endAngle) {\n  //   return false;\n  // }\n  const point = {\n    x: cx + r * Math.cos(angle),\n    y: cy + r * Math.sin(angle),\n  };\n\n  return distance(point.x, point.y, x, y) <= lineWidth / 2;\n}\n\nexport function inLine(\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  lineWidth: number,\n  x: number,\n  y: number,\n) {\n  const minX = Math.min(x1, x2);\n  const maxX = Math.max(x1, x2);\n  const minY = Math.min(y1, y2);\n  const maxY = Math.max(y1, y2);\n  const halfWidth = lineWidth / 2;\n  // 因为目前的方案是计算点到直线的距离，而有可能会在延长线上，所以要先判断是否在包围盒内\n  // 这种方案会在水平或者竖直的情况下载线的延长线上有半 lineWidth 的误差\n  if (\n    !(\n      x >= minX - halfWidth &&\n      x <= maxX + halfWidth &&\n      y >= minY - halfWidth &&\n      y <= maxY + halfWidth\n    )\n  ) {\n    return false;\n  }\n  // 因为已经计算了包围盒，所以仅需要计算到直线的距离即可，可以显著提升性能\n  return linePointToLine(x1, y1, x2, y2, x, y) <= lineWidth / 2;\n}\n\nexport function inPolyline(\n  points: any[],\n  lineWidth: number,\n  x: number,\n  y: number,\n  isClose: boolean,\n) {\n  const count = points.length;\n  if (count < 2) {\n    return false;\n  }\n  for (let i = 0; i < count - 1; i++) {\n    const x1 = points[i][0];\n    const y1 = points[i][1];\n    const x2 = points[i + 1][0];\n    const y2 = points[i + 1][1];\n\n    if (inLine(x1, y1, x2, y2, lineWidth, x, y)) {\n      return true;\n    }\n  }\n\n  // 如果封闭，则计算起始点和结束点的边\n  if (isClose) {\n    const first = points[0];\n    const last = points[count - 1];\n    if (inLine(first[0], first[1], last[0], last[1], lineWidth, x, y)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// 多边形的射线检测，参考：https://blog.csdn.net/WilliamSun0122/article/details/77994526\nconst tolerance = 1e-6;\n// 三态函数，判断两个double在eps精度下的大小关系\nfunction dcmp(x: number) {\n  if (Math.abs(x) < tolerance) {\n    return 0;\n  }\n\n  return x < 0 ? -1 : 1;\n}\n\n// 判断点Q是否在p1和p2的线段上\nfunction onSegment(p1: any, p2: any, q: any) {\n  if (\n    (q[0] - p1[0]) * (p2[1] - p1[1]) === (p2[0] - p1[0]) * (q[1] - p1[1]) &&\n    Math.min(p1[0], p2[0]) <= q[0] &&\n    q[0] <= Math.max(p1[0], p2[0]) &&\n    Math.min(p1[1], p2[1]) <= q[1] &&\n    q[1] <= Math.max(p1[1], p2[1])\n  ) {\n    return true;\n  }\n  return false;\n}\n\n// 判断点P在多边形内-射线法\nexport function inPolygon(points: any[], x: number, y: number) {\n  let isHit = false;\n  const n = points.length;\n  if (n <= 2) {\n    // svg 中点小于 3 个时，不显示，也无法被拾取\n    return false;\n  }\n  for (let i = 0; i < n; i++) {\n    const p1 = points[i];\n    const p2 = points[(i + 1) % n];\n    if (onSegment(p1, p2, [x, y])) {\n      // 点在多边形一条边上\n      return true;\n    }\n    // 前一个判断min(p1[1],p2[1])<P.y<=max(p1[1],p2[1])\n    // 后一个判断被测点 在 射线与边交点 的左边\n    if (\n      dcmp(p1[1] - y) > 0 !== dcmp(p2[1] - y) > 0 &&\n      dcmp(x - ((y - p1[1]) * (p1[0] - p2[0])) / (p1[1] - p2[1]) - p1[0]) < 0\n    ) {\n      isHit = !isHit;\n    }\n  }\n  return isHit;\n}\nexport function inPolygons(polygons: any[], x: number, y: number): boolean {\n  let isHit = false;\n  for (let i = 0; i < polygons.length; i++) {\n    const points = polygons[i];\n    isHit = inPolygon(points, x, y);\n    if (isHit) {\n      break;\n    }\n  }\n  return isHit;\n}\n","import type {\n  DisplayObject,\n  LineStyleProps,\n  ParsedLineStyleProps,\n  Point,\n} from '@antv/g-lite';\nimport { isFillOrStrokeAffected } from '@antv/g-lite';\nimport { inLine } from './utils/math';\n\nexport function isPointInPath(\n  displayObject: DisplayObject<LineStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n): boolean {\n  const {\n    x1,\n    y1,\n    x2,\n    y2,\n    lineWidth = 1,\n    increasedLineWidthForHitTesting = 0,\n    pointerEvents = 'auto',\n    fill,\n    stroke,\n  } = displayObject.parsedStyle as ParsedLineStyleProps;\n\n  const [, hasStroke] = isFillOrStrokeAffected(pointerEvents, fill, stroke);\n\n  if ((!hasStroke && !isClipPath) || !lineWidth) {\n    return false;\n  }\n\n  return inLine(\n    x1,\n    y1,\n    x2,\n    y2,\n    lineWidth + increasedLineWidthForHitTesting,\n    position.x,\n    position.y,\n  );\n}\n","import type {\n  DisplayObject,\n  GlobalRuntime,\n  ParsedPathStyleProps,\n  Path,\n  PathSegment,\n  PathStyleProps,\n  Point,\n  RenderingPluginContext,\n} from '@antv/g-lite';\nimport {\n  getOrCalculatePathTotalLength,\n  isFillOrStrokeAffected,\n} from '@antv/g-lite';\nimport { cubicPointDistance, quadPointDistance } from '@antv/g-math';\nimport { arcToCubic } from '@antv/util';\nimport { inBox, inLine, inPolygons } from './utils/math';\n\n// TODO: replace it with method in @antv/util\nfunction isPointInStroke(\n  segments: PathSegment[],\n  lineWidth: number,\n  px: number,\n  py: number,\n  length: number,\n) {\n  let isHit = false;\n  const halfWidth = lineWidth / 2;\n  for (let i = 0; i < segments.length; i++) {\n    const segment = segments[i];\n    const { currentPoint, params, prePoint, box } = segment;\n    // 如果在前面已经生成过包围盒，直接按照包围盒计算\n    if (\n      box &&\n      !inBox(\n        box.x - halfWidth,\n        box.y - halfWidth,\n        box.width + lineWidth,\n        box.height + lineWidth,\n        px,\n        py,\n      )\n    ) {\n      continue;\n    }\n    switch (segment.command) {\n      // L 和 Z 都是直线， M 不进行拾取\n      case 'L':\n      case 'Z':\n        isHit = inLine(\n          prePoint[0],\n          prePoint[1],\n          currentPoint[0],\n          currentPoint[1],\n          lineWidth,\n          px,\n          py,\n        );\n        if (isHit) {\n          return true;\n        }\n        break;\n      case 'Q':\n        const qDistance = quadPointDistance(\n          prePoint[0],\n          prePoint[1],\n          params[1],\n          params[2],\n          params[3],\n          params[4],\n          px,\n          py,\n        );\n        isHit = qDistance <= lineWidth / 2;\n        if (isHit) {\n          return true;\n        }\n        break;\n      case 'C':\n        const cDistance = cubicPointDistance(\n          prePoint[0], // 上一段结束位置, 即 C 的起始点\n          prePoint[1],\n          params[1], // 'C' 的参数，1、2 为第一个控制点，3、4 为第二个控制点，5、6 为结束点\n          params[2],\n          params[3],\n          params[4],\n          params[5],\n          params[6],\n          px,\n          py,\n          length,\n        );\n        isHit = cDistance <= lineWidth / 2;\n        if (isHit) {\n          return true;\n        }\n        break;\n      case 'A':\n        // cache conversion result\n        if (!segment.cubicParams) {\n          segment.cubicParams = arcToCubic(\n            prePoint[0],\n            prePoint[1],\n            params[1],\n            params[2],\n            params[3],\n            params[4],\n            params[5],\n            params[6],\n            params[7],\n            undefined,\n          ) as [number, number, number, number, number, number];\n        }\n\n        const args = segment.cubicParams;\n\n        // fixArc\n        let prePointInCubic = prePoint;\n        for (let i = 0; i < args.length; i += 6) {\n          const cDistance = cubicPointDistance(\n            prePointInCubic[0], // 上一段结束位置, 即 C 的起始点\n            prePointInCubic[1],\n            args[i],\n            args[i + 1],\n            args[i + 2],\n            args[i + 3],\n            args[i + 4],\n            args[i + 5],\n            px,\n            py,\n            length,\n          );\n          prePointInCubic = [args[i + 4], args[i + 5]];\n          isHit = cDistance <= lineWidth / 2;\n\n          if (isHit) {\n            return true;\n          }\n        }\n        break;\n      default:\n        break;\n    }\n  }\n  return isHit;\n}\n\nexport function isPointInPath(\n  displayObject: DisplayObject<PathStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n  isPointInPath: (\n    displayObject: DisplayObject<PathStyleProps>,\n    position: Point,\n  ) => boolean,\n  renderingPluginContext: RenderingPluginContext,\n  runtime: GlobalRuntime,\n): boolean {\n  const {\n    lineWidth = 1,\n    increasedLineWidthForHitTesting = 0,\n    stroke,\n    fill,\n    d,\n    pointerEvents = 'auto',\n  } = displayObject.parsedStyle as ParsedPathStyleProps;\n\n  const { segments, hasArc, polylines, polygons } = d;\n  const [hasFill, hasStroke] = isFillOrStrokeAffected(\n    pointerEvents,\n    // Only a closed path can be filled.\n    polygons?.length && fill,\n    stroke,\n  );\n\n  const totalLength = getOrCalculatePathTotalLength(displayObject as Path);\n\n  let isHit = false;\n\n  if (hasFill || isClipPath) {\n    if (hasArc) {\n      // 存在曲线时，暂时使用 canvas 的 api 计算，后续可以进行多边形切割\n      isHit = isPointInPath(displayObject, position);\n    } else {\n      // 提取出来的多边形包含闭合的和非闭合的，在这里统一按照多边形处理\n      isHit =\n        inPolygons(polygons, position.x, position.y) ||\n        inPolygons(polylines, position.x, position.y);\n    }\n    return isHit;\n  }\n  if (hasStroke || isClipPath) {\n    isHit = isPointInStroke(\n      segments,\n      lineWidth + increasedLineWidthForHitTesting,\n      position.x,\n      position.y,\n      totalLength,\n    );\n  }\n\n  return isHit;\n}\n","import type {\n  DisplayObject,\n  ParsedPolygonStyleProps,\n  Point,\n  PolylineStyleProps,\n} from '@antv/g-lite';\nimport { isFillOrStrokeAffected } from '@antv/g-lite';\nimport { inPolygon, inPolyline } from './utils/math';\n\nexport function isPointInPath(\n  displayObject: DisplayObject<PolylineStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n): boolean {\n  const {\n    stroke,\n    fill,\n    lineWidth = 1,\n    increasedLineWidthForHitTesting = 0,\n    points,\n    pointerEvents = 'auto',\n  } = displayObject.parsedStyle as ParsedPolygonStyleProps;\n  const [hasFill, hasStroke] = isFillOrStrokeAffected(\n    pointerEvents,\n    fill,\n    stroke,\n  );\n\n  let isHit = false;\n  if (hasStroke || isClipPath) {\n    isHit = inPolyline(\n      points.points,\n      lineWidth + increasedLineWidthForHitTesting,\n      position.x,\n      position.y,\n      true,\n    );\n  }\n  if (!isHit && (hasFill || isClipPath)) {\n    isHit = inPolygon(points.points, position.x, position.y);\n  }\n  return isHit;\n}\n","import type {\n  DisplayObject,\n  ParsedPolylineStyleProps,\n  Point,\n  PolylineStyleProps,\n} from '@antv/g-lite';\nimport { isFillOrStrokeAffected } from '@antv/g-lite';\nimport { inPolyline } from './utils/math';\n\nexport function isPointInPath(\n  displayObject: DisplayObject<PolylineStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n): boolean {\n  const {\n    lineWidth = 1,\n    increasedLineWidthForHitTesting = 0,\n    points,\n    pointerEvents = 'auto',\n    fill,\n    stroke,\n  } = displayObject.parsedStyle as ParsedPolylineStyleProps;\n  const [, hasStroke] = isFillOrStrokeAffected(pointerEvents, fill, stroke);\n\n  if ((!hasStroke && !isClipPath) || !lineWidth) {\n    return false;\n  }\n\n  return inPolyline(\n    points.points,\n    lineWidth + increasedLineWidthForHitTesting,\n    position.x,\n    position.y,\n    false,\n  );\n}\n","import type {\n  DisplayObject,\n  ParsedRectStyleProps,\n  Point,\n  RectStyleProps,\n} from '@antv/g-lite';\nimport { GlobalRuntime, isFillOrStrokeAffected } from '@antv/g-lite';\nimport { clamp } from '@antv/util';\nimport { inArc, inBox, inLine, inRect } from './utils/math';\n\nexport function isPointInPath(\n  displayObject: DisplayObject<RectStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n  isPointInPath: (\n    displayObject: DisplayObject<RectStyleProps>,\n    position: Point,\n  ) => boolean,\n  runtime: GlobalRuntime,\n): boolean {\n  const {\n    radius,\n    fill,\n    stroke,\n    lineWidth = 1,\n    increasedLineWidthForHitTesting = 0,\n    x = 0,\n    y = 0,\n    width,\n    height,\n    pointerEvents = 'auto',\n  } = displayObject.parsedStyle as ParsedRectStyleProps;\n\n  const [hasFill, hasStroke] = isFillOrStrokeAffected(\n    pointerEvents,\n    fill,\n    stroke,\n  );\n\n  const hasRadius = radius && radius.some((r) => r !== 0);\n\n  const lineWidthForHitTesting = lineWidth + increasedLineWidthForHitTesting;\n\n  // 无圆角时的策略\n  if (!hasRadius) {\n    const halfWidth = lineWidthForHitTesting / 2;\n    // 同时填充和带有边框\n    if ((hasFill && hasStroke) || isClipPath) {\n      return inBox(\n        x - halfWidth,\n        y - halfWidth,\n        width + halfWidth,\n        height + halfWidth,\n        position.x,\n        position.y,\n      );\n    }\n    // 仅填充\n    if (hasFill) {\n      return inBox(x, y, width, height, position.x, position.y);\n    }\n    if (hasStroke) {\n      return inRect(\n        x,\n        y,\n        width,\n        height,\n        lineWidthForHitTesting,\n        position.x,\n        position.y,\n      );\n    }\n  } else {\n    let isHit = false;\n    if (hasStroke || isClipPath) {\n      isHit = inRectWithRadius(\n        x,\n        y,\n        width,\n        height,\n        radius.map((r) =>\n          clamp(r, 0, Math.min(Math.abs(width) / 2, Math.abs(height) / 2)),\n        ) as [number, number, number, number],\n        lineWidthForHitTesting,\n        position.x,\n        position.y,\n      );\n    }\n    // 仅填充时带有圆角的矩形直接通过图形拾取\n    // 以后可以改成纯数学的近似拾取，将圆弧切割成多边形\n    if (!isHit && (hasFill || isClipPath)) {\n      isHit = isPointInPath(displayObject, position);\n    }\n    return isHit;\n  }\n\n  return false;\n}\n\nfunction inRectWithRadius(\n  minX: number,\n  minY: number,\n  width: number,\n  height: number,\n  radiusArray: [number, number, number, number],\n  lineWidth: number,\n  x: number,\n  y: number,\n) {\n  const [tlr, trr, brr, blr] = radiusArray;\n  return (\n    inLine(minX + tlr, minY, minX + width - trr, minY, lineWidth, x, y) ||\n    inLine(\n      minX + width,\n      minY + trr,\n      minX + width,\n      minY + height - brr,\n      lineWidth,\n      x,\n      y,\n    ) ||\n    inLine(\n      minX + width - brr,\n      minY + height,\n      minX + blr,\n      minY + height,\n      lineWidth,\n      x,\n      y,\n    ) ||\n    inLine(minX, minY + height - blr, minX, minY + tlr, lineWidth, x, y) ||\n    inArc(\n      minX + width - trr,\n      minY + trr,\n      trr,\n      1.5 * Math.PI,\n      2 * Math.PI,\n      lineWidth,\n      x,\n      y,\n    ) ||\n    inArc(\n      minX + width - brr,\n      minY + height - brr,\n      brr,\n      0,\n      0.5 * Math.PI,\n      lineWidth,\n      x,\n      y,\n    ) ||\n    inArc(\n      minX + blr,\n      minY + height - blr,\n      blr,\n      0.5 * Math.PI,\n      Math.PI,\n      lineWidth,\n      x,\n      y,\n    ) ||\n    inArc(minX + tlr, minY + tlr, tlr, Math.PI, 1.5 * Math.PI, lineWidth, x, y)\n  );\n}\n","import {\n  DisplayObject,\n  ParsedImageStyleProps,\n  Point,\n  ImageStyleProps,\n  Shape,\n  RenderingPluginContext,\n  GlobalRuntime,\n} from '@antv/g-lite';\nimport { StyleRenderer } from '@antv/g-plugin-canvas-renderer';\n\nexport function isPointInPath(\n  displayObject: DisplayObject<ImageStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n  isPointInPath: (\n    displayObject: DisplayObject<ImageStyleProps>,\n    position: Point,\n  ) => boolean,\n  renderingPluginContext: RenderingPluginContext,\n  runtime: GlobalRuntime,\n): boolean {\n  const {\n    pointerEvents = 'auto',\n    x = 0,\n    y = 0,\n    width,\n    height,\n  } = displayObject.parsedStyle as ParsedImageStyleProps;\n\n  if (pointerEvents === 'non-transparent-pixel') {\n    const { offscreenCanvas } = renderingPluginContext.config;\n    const canvas =\n      runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas);\n    const context = runtime.offscreenCanvasCreator.getOrCreateContext(\n      offscreenCanvas,\n      {\n        willReadFrequently: true,\n      },\n    ) as CanvasRenderingContext2D;\n    canvas.width = width;\n    canvas.height = height;\n\n    (\n      (renderingPluginContext as any).defaultStyleRendererFactory as Record<\n        Shape,\n        StyleRenderer\n      >\n    )[Shape.IMAGE].render(\n      context,\n      { ...displayObject.parsedStyle, x: 0, y: 0 },\n      displayObject,\n      undefined,\n      undefined,\n      undefined,\n    );\n\n    const imagedata = context.getImageData(\n      position.x - x,\n      position.y - y,\n      1,\n      1,\n    ).data;\n    return imagedata.every((component) => component !== 0);\n  }\n\n  return true;\n}\n","import type { DisplayObject, Point, TextStyleProps } from '@antv/g-lite';\n\nexport function isPointInPath(\n  displayObject: DisplayObject<TextStyleProps>,\n  position: Point,\n  isClipPath: boolean,\n  isPointInPath: (\n    displayObject: DisplayObject<TextStyleProps>,\n    position: Point,\n  ) => boolean,\n): boolean {\n  const bounds = displayObject.getGeometryBounds();\n\n  // @see https://stackoverflow.com/questions/28706989/how-do-i-check-if-a-mouse-click-is-inside-a-rotated-text-on-the-html5-canvas-in\n  return (\n    position.x >= bounds.min[0] &&\n    position.y >= bounds.min[1] &&\n    position.x <= bounds.max[0] &&\n    position.y <= bounds.max[1]\n  );\n}\n","import { AbstractRendererPlugin, Shape } from '@antv/g-lite';\nimport type { PointInPathPicker } from './CanvasPickerPlugin';\nimport { CanvasPickerPlugin } from './CanvasPickerPlugin';\nimport { isPointInPath as CirclePicker } from './Circle';\nimport { isPointInPath as EllipsePicker } from './Ellipse';\nimport { isPointInPath as LinePicker } from './Line';\nimport { isPointInPath as PathPicker } from './Path';\nimport { isPointInPath as PolygonPicker } from './Polygon';\nimport { isPointInPath as PolylinePicker } from './Polyline';\nimport { isPointInPath as RectPicker } from './Rect';\nimport { isPointInPath as ImagePicker } from './Image';\nimport { isPointInPath as TextPicker } from './Text';\n\nexport class Plugin extends AbstractRendererPlugin {\n  name = 'canvas-picker';\n  init(): void {\n    const pointInPathPickerFactory: Record<Shape, PointInPathPicker<any>> = {\n      [Shape.CIRCLE]: CirclePicker,\n      [Shape.ELLIPSE]: EllipsePicker,\n      [Shape.RECT]: RectPicker,\n      [Shape.LINE]: LinePicker,\n      [Shape.POLYLINE]: PolylinePicker,\n      [Shape.POLYGON]: PolygonPicker,\n      [Shape.PATH]: PathPicker,\n      [Shape.TEXT]: TextPicker,\n      [Shape.GROUP]: null,\n      [Shape.IMAGE]: ImagePicker,\n      [Shape.HTML]: null,\n      [Shape.MESH]: null,\n    };\n\n    // @ts-ignore\n    this.context.pointInPathPickerFactory = pointInPathPickerFactory;\n\n    this.addRenderingPlugin(new CanvasPickerPlugin());\n  }\n  destroy(): void {\n    // @ts-ignore\n    delete this.context.pointInPathPickerFactory;\n    this.removeAllRenderingPlugins();\n  }\n}\n"],"names":["tmpVec3a","vec3","create","tmpVec3b","tmpVec3c","tmpMat4","mat4","CanvasPickerPlugin","_this","_classCallCheck","isHit","displayObject","position","worldTransform","isClipPath","pick","context","pointInPathPickerFactory","nodeName","invertWorldMat","invert","localPosition","transformMat4","set","Point","isPointInPath","runtime","offscreenCanvasCreator","getOrCreateContext","config","offscreenCanvas","generatePath","pathGeneratorFactory","beginPath","parsedStyle","closePath","x","y","_createClass","key","value","apply","_renderingContext$roo","_this2","renderingService","renderingContext","document","root","ownerDocument","hooks","tapPromise","tag","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","result","wrap","_callee$","_context","prev","next","abrupt","stop","_x","arguments","pickSync","tap","topmost","_result$position","hitTestList","elementsFromBBox","pickedDisplayObjects","_iterator","_createForOfIteratorHelper","_step","s","n","done","getWorldTransform","isHitOriginShape","clipped","findClosestClipPathTarget","clipPath","isHitClipPath","picked","push","err","e","f","_ref$cx","cx","_ref$cy","cy","r","fill","stroke","_ref$lineWidth","lineWidth","_ref$increasedLineWid","increasedLineWidthForHitTesting","_ref$pointerEvents","pointerEvents","halfLineWidth","absDistance","distance","_isFillOrStrokeAffect","isFillOrStrokeAffected","_isFillOrStrokeAffect2","_slicedToArray","hasFill","hasStroke","ellipseDistance","squareX","squareY","rx","ry","halfLineWith","inBox","minX","minY","width","height","inRect","halfWidth","inArc","startAngle","endAngle","angle","Math","atan2","PI","point","cos","sin","inLine","x1","y1","x2","y2","min","maxX","max","maxY","linePointToLine","inPolyline","points","isClose","count","length","i","first","last","tolerance","dcmp","abs","onSegment","p1","p2","q","inPolygon","inPolygons","polygons","isPointInStroke","segments","px","py","segment","currentPoint","params","prePoint","box","command","qDistance","quadPointDistance","cDistance","cubicPointDistance","cubicParams","arcToCubic","undefined","args","prePointInCubic","renderingPluginContext","d","hasArc","polylines","totalLength","getOrCalculatePathTotalLength","radius","_ref$x","_ref$y","hasRadius","some","lineWidthForHitTesting","inRectWithRadius","map","clamp","radiusArray","_radiusArray","tlr","trr","brr","blr","canvas","getOrCreateCanvas","willReadFrequently","defaultStyleRendererFactory","Shape","IMAGE","render","_objectSpread","imagedata","getImageData","data","every","component","bounds","getGeometryBounds","Plugin","_AbstractRendererPlug","_len","Array","_key","_callSuper","concat","name","_inherits","init","_pointInPathPickerFac","_defineProperty","CIRCLE","CirclePicker","ELLIPSE","EllipsePicker","RECT","RectPicker","LINE","LinePicker","POLYLINE","PolylinePicker","POLYGON","PolygonPicker","PATH","PathPicker","TEXT","TextPicker","GROUP","ImagePicker","HTML","MESH","addRenderingPlugin","destroy","removeAllRenderingPlugins","AbstractRendererPlugin"],"mappings":"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"}