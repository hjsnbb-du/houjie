{"version":3,"file":"index.esm.js","sources":["../src/CanvasRendererPlugin.ts","../src/shapes/styles/helper.ts","../src/shapes/styles/OptimizedDefault.ts","../src/shapes/styles/Default.ts","../src/utils/math.ts","../src/shapes/styles/Image.ts","../src/shapes/styles/Text.ts","../src/index.ts"],"sourcesContent":["import type {\n  DisplayObject,\n  FederatedEvent,\n  RBushNodeAABB,\n  RenderingPlugin,\n  RBush,\n  RenderingPluginContext,\n  ContextService,\n  CanvasContext,\n  GlobalRuntime,\n  CSSRGB,\n  ParsedBaseStyleProps,\n} from '@antv/g-lite';\nimport {\n  AABB,\n  CanvasEvent,\n  CustomEvent,\n  ElementEvent,\n  Shape,\n  Node,\n} from '@antv/g-lite';\nimport { mat4, vec3 } from 'gl-matrix';\nimport { isNil } from '@antv/util';\nimport type { CanvasRendererPluginOptions } from './interfaces';\nimport type { Plugin } from '.';\n\ninterface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface RenderState {\n  restoreStack: DisplayObject[];\n  prevObject: DisplayObject;\n  currentContext: Map<keyof CanvasRenderingContext2D | 'lineDash', unknown>;\n}\n\n/**\n * support 2 modes in rendering:\n * * immediate\n * * delayed: render at the end of frame with dirty-rectangle\n */\nexport class CanvasRendererPlugin implements RenderingPlugin {\n  static tag = 'CanvasRenderer';\n\n  private context: Plugin['context'];\n\n  private pathGeneratorFactory: Plugin['context']['pathGeneratorFactory'];\n\n  /**\n   * RBush used in dirty rectangle rendering\n   */\n  private rBush: RBush<RBushNodeAABB>;\n\n  constructor(\n    private canvasRendererPluginOptions: CanvasRendererPluginOptions, // private styleRendererFactory: Record<Shape, StyleRenderer>,\n  ) {}\n\n  private removedRBushNodeAABBs: RBushNodeAABB[] = [];\n\n  private renderQueue: DisplayObject[] = [];\n\n  #renderState: RenderState = {\n    restoreStack: [],\n    prevObject: null,\n    currentContext: new Map(),\n  };\n\n  private clearFullScreenLastFrame = false;\n  private clearFullScreen = false;\n\n  /**\n   * view projection matrix\n   */\n  private vpMatrix = mat4.create();\n  private dprMatrix = mat4.create();\n  private tmpMat4 = mat4.create();\n  private vec3a = vec3.create();\n  private vec3b = vec3.create();\n  private vec3c = vec3.create();\n  private vec3d = vec3.create();\n\n  apply(context: RenderingPluginContext, runtime: GlobalRuntime) {\n    this.context = context as unknown as Plugin['context'];\n\n    const {\n      config,\n      camera,\n      renderingService,\n      renderingContext,\n      rBushRoot,\n      // @ts-ignore\n      pathGeneratorFactory,\n    } = this.context;\n    let enableRenderingOptimization =\n      config.renderer.getConfig().enableRenderingOptimization;\n\n    config.renderer.getConfig().enableDirtyCheck = false;\n    config.renderer.getConfig().enableDirtyRectangleRendering = false;\n\n    this.rBush = rBushRoot;\n    this.pathGeneratorFactory = pathGeneratorFactory;\n\n    const contextService =\n      context.contextService as ContextService<CanvasRenderingContext2D>;\n\n    const canvas = renderingContext.root.ownerDocument.defaultView;\n\n    const handleUnmounted = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n\n      // remove r-bush node\n      // @ts-ignore\n      const { rBushNode } = object;\n\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n\n    const handleCulled = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n      // @ts-ignore\n      const { rBushNode } = object;\n\n      if (rBushNode.aabb) {\n        // save removed aabbs for dirty-rectangle rendering later\n        this.removedRBushNodeAABBs.push(rBushNode.aabb);\n      }\n    };\n\n    renderingService.hooks.init.tap(CanvasRendererPlugin.tag, () => {\n      canvas.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.addEventListener(ElementEvent.CULLED, handleCulled);\n\n      // clear fullscreen\n      const dpr = contextService.getDPR();\n      const { width, height } = config;\n      const context = contextService.getContext();\n      this.clearRect(\n        context,\n        0,\n        0,\n        width * dpr,\n        height * dpr,\n        config.background,\n      );\n    });\n\n    renderingService.hooks.destroy.tap(CanvasRendererPlugin.tag, () => {\n      canvas.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.removeEventListener(ElementEvent.CULLED, handleCulled);\n      this.renderQueue = [];\n      this.removedRBushNodeAABBs = [];\n      this.#renderState = {\n        restoreStack: [],\n        prevObject: null,\n        currentContext: null,\n      };\n    });\n\n    renderingService.hooks.beginFrame.tap(CanvasRendererPlugin.tag, () => {\n      const context = contextService.getContext();\n      const dpr = contextService.getDPR();\n      const { width, height } = config;\n      const { dirtyObjectNumThreshold, dirtyObjectRatioThreshold } =\n        this.canvasRendererPluginOptions;\n\n      // some heuristic conditions such as 80% object changed\n      const { total, rendered } = renderingService.getStats();\n      const ratio = rendered / total;\n\n      this.clearFullScreen =\n        this.clearFullScreenLastFrame ||\n        // @ts-ignore\n        !canvas.context.renderingPlugins[1]?.isFirstTimeRenderingFinished ||\n        renderingService.disableDirtyRectangleRendering() ||\n        (rendered > dirtyObjectNumThreshold &&\n          ratio > dirtyObjectRatioThreshold);\n\n      if (context) {\n        if (typeof context.resetTransform === 'function') {\n          context.resetTransform();\n        } else {\n          context.setTransform(1, 0, 0, 1, 0, 0);\n        }\n\n        if (this.clearFullScreen) {\n          this.clearRect(\n            context,\n            0,\n            0,\n            width * dpr,\n            height * dpr,\n            config.background,\n          );\n        }\n      }\n    });\n\n    /**\n     * render objects by z-index\n     *\n     * - The level of the child node will be affected by the level of the parent node\n     */\n    const renderByZIndex = (\n      object: DisplayObject,\n      context: CanvasRenderingContext2D,\n    ) => {\n      const stack = [object];\n\n      while (stack.length > 0) {\n        const currentObject = stack.pop();\n\n        if (currentObject.isVisible() && !currentObject.isCulled()) {\n          if (enableRenderingOptimization) {\n            this.renderDisplayObjectOptimized(\n              currentObject,\n              context,\n              this.context,\n              this.#renderState,\n              runtime,\n            );\n          } else {\n            this.renderDisplayObject(\n              currentObject,\n              context,\n              this.context,\n              this.#renderState,\n              runtime,\n            );\n          }\n        }\n\n        const objects =\n          currentObject.sortable.sorted || currentObject.childNodes;\n        // should account for z-index\n        for (let i = objects.length - 1; i >= 0; i--) {\n          stack.push(objects[i] as unknown as DisplayObject);\n        }\n      }\n    };\n\n    // render at the end of frame\n    renderingService.hooks.endFrame.tap(CanvasRendererPlugin.tag, () => {\n      // Skip rendering.\n      if (renderingContext.root.childNodes.length === 0) {\n        this.clearFullScreenLastFrame = true;\n        return;\n      }\n\n      enableRenderingOptimization =\n        config.renderer.getConfig().enableRenderingOptimization;\n\n      // init\n      this.#renderState = {\n        restoreStack: [],\n        prevObject: null,\n        currentContext: this.#renderState.currentContext,\n      };\n      this.#renderState.currentContext.clear();\n      this.clearFullScreenLastFrame = false;\n\n      const context = contextService.getContext();\n      // clear & clip dirty rectangle\n      const dpr = contextService.getDPR();\n      mat4.fromScaling(this.dprMatrix, [dpr, dpr, 1]);\n      mat4.multiply(this.vpMatrix, this.dprMatrix, camera.getOrthoMatrix());\n\n      if (this.clearFullScreen) {\n        // console.time('renderByZIndex');\n        if (enableRenderingOptimization) {\n          context.save();\n          renderByZIndex(renderingContext.root, context);\n          context.restore();\n        } else {\n          renderByZIndex(renderingContext.root, context);\n        }\n        // console.timeEnd('renderByZIndex');\n\n        this.removedRBushNodeAABBs = [];\n      } else {\n        // console.log('canvas renderer next...', this.renderQueue);\n        // merge removed AABB\n        const dirtyRenderBounds = this.safeMergeAABB(\n          this.mergeDirtyAABBs(this.renderQueue),\n          ...this.removedRBushNodeAABBs.map(({ minX, minY, maxX, maxY }) => {\n            const aabb = new AABB();\n            aabb.setMinMax(\n              // vec3.fromValues(minX, minY, 0),\n              // vec3.fromValues(maxX, maxY, 0),\n              [minX, minY, 0],\n              [maxX, maxY, 0],\n            );\n            return aabb;\n          }),\n        );\n        this.removedRBushNodeAABBs = [];\n\n        if (AABB.isEmpty(dirtyRenderBounds)) {\n          this.renderQueue = [];\n          return;\n        }\n\n        const dirtyRect = this.convertAABB2Rect(dirtyRenderBounds);\n        const { x, y, width, height } = dirtyRect;\n\n        const tl = vec3.transformMat4(this.vec3a, [x, y, 0], this.vpMatrix);\n        const tr = vec3.transformMat4(\n          this.vec3b,\n          [x + width, y, 0],\n          this.vpMatrix,\n        );\n        const bl = vec3.transformMat4(\n          this.vec3c,\n          [x, y + height, 0],\n          this.vpMatrix,\n        );\n        const br = vec3.transformMat4(\n          this.vec3d,\n          [x + width, y + height, 0],\n          this.vpMatrix,\n        );\n\n        const minx = Math.min(tl[0], tr[0], br[0], bl[0]);\n        const miny = Math.min(tl[1], tr[1], br[1], bl[1]);\n        const maxx = Math.max(tl[0], tr[0], br[0], bl[0]);\n        const maxy = Math.max(tl[1], tr[1], br[1], bl[1]);\n\n        const ix = Math.floor(minx);\n        const iy = Math.floor(miny);\n        const iwidth = Math.ceil(maxx - minx);\n        const iheight = Math.ceil(maxy - miny);\n\n        context.save();\n        this.clearRect(context, ix, iy, iwidth, iheight, config.background);\n        context.beginPath();\n        context.rect(ix, iy, iwidth, iheight);\n        context.clip();\n\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n        context.setTransform(\n          this.vpMatrix[0],\n          this.vpMatrix[1],\n          this.vpMatrix[4],\n          this.vpMatrix[5],\n          this.vpMatrix[12],\n          this.vpMatrix[13],\n        );\n\n        // draw dirty rectangle\n        const { enableDirtyRectangleRenderingDebug } =\n          config.renderer.getConfig();\n        if (enableDirtyRectangleRenderingDebug) {\n          canvas.dispatchEvent(\n            new CustomEvent(CanvasEvent.DIRTY_RECTANGLE, {\n              dirtyRect: {\n                x: ix,\n                y: iy,\n                width: iwidth,\n                height: iheight,\n              },\n            }),\n          );\n        }\n\n        // search objects intersect with dirty rectangle\n        const dirtyObjects = this.searchDirtyObjects(dirtyRenderBounds);\n\n        // do rendering\n        dirtyObjects\n          // sort by z-index\n          .sort((a, b) => a.sortable.renderOrder - b.sortable.renderOrder)\n          .forEach((object) => {\n            // culled object should not be rendered\n            if (object && object.isVisible() && !object.isCulled()) {\n              this.renderDisplayObject(\n                object,\n                context,\n                this.context,\n                this.#renderState,\n                runtime,\n              );\n            }\n          });\n\n        context.restore();\n\n        // save dirty AABBs in last frame\n        this.renderQueue.forEach((object) => {\n          this.saveDirtyAABB(object);\n        });\n\n        // clear queue\n        this.renderQueue = [];\n      }\n\n      // pop restore stack, eg. root -> parent -> child\n      this.#renderState.restoreStack.forEach(() => {\n        context.restore();\n      });\n      // clear restore stack\n      this.#renderState.restoreStack = [];\n    });\n\n    renderingService.hooks.render.tap(\n      CanvasRendererPlugin.tag,\n      (object: DisplayObject) => {\n        if (!this.clearFullScreen) {\n          // render at the end of frame\n          this.renderQueue.push(object);\n        }\n      },\n    );\n  }\n\n  private clearRect(\n    context: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    background: string,\n  ) {\n    // clearRect is faster than fillRect @see https://stackoverflow.com/a/30830253\n    context.clearRect(x, y, width, height);\n    if (background) {\n      context.fillStyle = background;\n      context.fillRect(x, y, width, height);\n    }\n  }\n\n  renderDisplayObjectOptimized(\n    object: DisplayObject,\n    context: CanvasRenderingContext2D,\n    canvasContext: CanvasContext,\n    renderState: RenderState,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n    let updateTransform = false;\n    let clipDraw = false;\n\n    // @ts-ignore\n    const styleRenderer = this.context.styleRendererFactory[nodeName];\n    const generatePath = this.pathGeneratorFactory[nodeName];\n\n    // clip path\n    const { clipPath } = object.parsedStyle;\n    if (clipPath) {\n      updateTransform =\n        !renderState.prevObject ||\n        !mat4.exactEquals(\n          clipPath.getWorldTransform(),\n          renderState.prevObject.getWorldTransform(),\n        );\n\n      if (updateTransform) {\n        this.applyWorldTransform(context, clipPath);\n        renderState.prevObject = null;\n      }\n\n      // generate path in local space\n      const generatePath =\n        this.pathGeneratorFactory[clipPath.nodeName as Shape];\n      if (generatePath) {\n        context.save();\n        clipDraw = true;\n\n        context.beginPath();\n        generatePath(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n\n    // fill & stroke\n\n    if (styleRenderer) {\n      updateTransform =\n        !renderState.prevObject ||\n        !mat4.exactEquals(\n          object.getWorldTransform(),\n          renderState.prevObject.getWorldTransform(),\n        );\n\n      if (updateTransform) {\n        this.applyWorldTransform(context, object);\n      }\n\n      let forceUpdateStyle = !renderState.prevObject;\n      if (!forceUpdateStyle) {\n        const prevNodeName = renderState.prevObject.nodeName as Shape;\n\n        if (nodeName === Shape.TEXT) {\n          forceUpdateStyle = prevNodeName !== Shape.TEXT;\n        } else if (nodeName === Shape.IMAGE) {\n          forceUpdateStyle = prevNodeName !== Shape.IMAGE;\n        } else {\n          forceUpdateStyle =\n            prevNodeName === Shape.TEXT || prevNodeName === Shape.IMAGE;\n        }\n      }\n\n      styleRenderer.applyStyleToContext(\n        context,\n        object,\n        forceUpdateStyle,\n        renderState,\n      );\n\n      renderState.prevObject = object;\n    }\n\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (\n        nodeName !== Shape.LINE &&\n        nodeName !== Shape.PATH &&\n        nodeName !== Shape.POLYLINE\n      ) {\n        context.closePath();\n      }\n    }\n\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.drawToContext(\n        context,\n        object,\n        this.#renderState,\n        this,\n        runtime,\n      );\n    }\n\n    if (clipDraw) {\n      context.restore();\n    }\n\n    // finish rendering, clear dirty flag\n    object.renderable.dirty = false;\n  }\n\n  renderDisplayObject(\n    object: DisplayObject,\n    context: CanvasRenderingContext2D,\n    canvasContext: CanvasContext,\n    renderState: RenderState,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n\n    // restore to its ancestor\n\n    const parent =\n      renderState.restoreStack[renderState.restoreStack.length - 1];\n    if (\n      parent &&\n      !(\n        object.compareDocumentPosition(parent) & Node.DOCUMENT_POSITION_CONTAINS\n      )\n    ) {\n      context.restore();\n      renderState.restoreStack.pop();\n    }\n\n    // @ts-ignore\n    const styleRenderer = this.context.styleRendererFactory[nodeName];\n    const generatePath = this.pathGeneratorFactory[nodeName];\n\n    // clip path\n    const { clipPath } = object.parsedStyle;\n    if (clipPath) {\n      this.applyWorldTransform(context, clipPath);\n\n      // generate path in local space\n      const generatePath =\n        this.pathGeneratorFactory[clipPath.nodeName as Shape];\n      if (generatePath) {\n        context.save();\n\n        // save clip\n        renderState.restoreStack.push(object);\n\n        context.beginPath();\n        generatePath(context, clipPath.parsedStyle);\n        context.closePath();\n        context.clip();\n      }\n    }\n\n    // fill & stroke\n\n    if (styleRenderer) {\n      this.applyWorldTransform(context, object);\n\n      context.save();\n\n      // apply attributes to context\n      this.applyAttributesToContext(context, object);\n    }\n\n    if (generatePath) {\n      context.beginPath();\n      generatePath(context, object.parsedStyle);\n      if (\n        nodeName !== Shape.LINE &&\n        nodeName !== Shape.PATH &&\n        nodeName !== Shape.POLYLINE\n      ) {\n        context.closePath();\n      }\n    }\n\n    // fill & stroke\n    if (styleRenderer) {\n      styleRenderer.render(\n        context,\n        object.parsedStyle,\n        object,\n        canvasContext,\n        this,\n        runtime,\n      );\n\n      // restore applied attributes, eg. shadowBlur shadowColor...\n      context.restore();\n    }\n\n    // finish rendering, clear dirty flag\n    object.renderable.dirty = false;\n  }\n\n  applyAttributesToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n  ) {\n    const { stroke, fill, opacity, lineDash, lineDashOffset } =\n      object.parsedStyle as ParsedBaseStyleProps;\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setLineDash\n    if (lineDash) {\n      context.setLineDash(lineDash);\n    }\n\n    // @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineDashOffset\n    if (!isNil(lineDashOffset)) {\n      context.lineDashOffset = lineDashOffset;\n    }\n\n    if (!isNil(opacity)) {\n      context.globalAlpha *= opacity;\n    }\n\n    if (\n      !isNil(stroke) &&\n      !Array.isArray(stroke) &&\n      !(stroke as CSSRGB).isNone\n    ) {\n      context.strokeStyle = object.attributes.stroke as string;\n    }\n\n    if (!isNil(fill) && !Array.isArray(fill) && !(fill as CSSRGB).isNone) {\n      context.fillStyle = object.attributes.fill as string;\n    }\n  }\n\n  private convertAABB2Rect(aabb: AABB): Rect {\n    const min = aabb.getMin();\n    const max = aabb.getMax();\n    // expand the rectangle a bit to avoid artifacts\n    // @see https://www.yuque.com/antv/ou292n/bi8nix#ExvCu\n    const minX = Math.floor(min[0]);\n    const minY = Math.floor(min[1]);\n    const maxX = Math.ceil(max[0]);\n    const maxY = Math.ceil(max[1]);\n    const width = maxX - minX;\n    const height = maxY - minY;\n\n    return { x: minX, y: minY, width, height };\n  }\n\n  /**\n   * TODO: merge dirty rectangles with some strategies.\n   * For now, we just simply merge all the rectangles into one.\n   * @see https://idom.me/articles/841.html\n   */\n  private mergeDirtyAABBs(dirtyObjects: DisplayObject[]): AABB {\n    // merge into a big AABB\n    // TODO: skip descendant if ancestor is caculated, but compareNodePosition is really slow\n    const aabb = new AABB();\n    dirtyObjects.forEach((object) => {\n      const renderBounds = object.getRenderBounds();\n      aabb.add(renderBounds);\n\n      const { dirtyRenderBounds } = object.renderable;\n      if (dirtyRenderBounds) {\n        aabb.add(dirtyRenderBounds);\n      }\n    });\n\n    return aabb;\n  }\n\n  private searchDirtyObjects(dirtyRectangle: AABB): DisplayObject[] {\n    // search in r-tree, get all affected nodes\n    const [minX, minY] = dirtyRectangle.getMin();\n    const [maxX, maxY] = dirtyRectangle.getMax();\n    const rBushNodes = this.rBush.search({\n      minX,\n      minY,\n      maxX,\n      maxY,\n    });\n\n    return rBushNodes.map(({ displayObject }) => displayObject);\n  }\n\n  private saveDirtyAABB(object: DisplayObject) {\n    const { renderable } = object;\n    if (!renderable.dirtyRenderBounds) {\n      renderable.dirtyRenderBounds = new AABB();\n    }\n    const renderBounds = object.getRenderBounds();\n    if (renderBounds) {\n      // save last dirty aabb\n      renderable.dirtyRenderBounds.update(\n        renderBounds.center,\n        renderBounds.halfExtents,\n      );\n    }\n  }\n\n  private applyWorldTransform(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    matrix?: mat4,\n  ) {\n    // apply clip shape's RTS\n    if (matrix) {\n      mat4.copy(this.tmpMat4, object.getLocalTransform());\n      mat4.multiply(this.tmpMat4, matrix, this.tmpMat4);\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    } else {\n      // apply RTS transformation in world space\n      mat4.copy(this.tmpMat4, object.getWorldTransform());\n      mat4.multiply(this.tmpMat4, this.vpMatrix, this.tmpMat4);\n    }\n\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations\n    context.setTransform(\n      this.tmpMat4[0],\n      this.tmpMat4[1],\n      this.tmpMat4[4],\n      this.tmpMat4[5],\n      this.tmpMat4[12],\n      this.tmpMat4[13],\n    );\n  }\n\n  private safeMergeAABB(...aabbs: AABB[]): AABB {\n    const merged = new AABB();\n    aabbs.forEach((aabb) => {\n      merged.add(aabb);\n    });\n    return merged;\n  }\n}\n","import {\n  CanvasContext,\n  CSSGradientValue,\n  DisplayObject,\n  GlobalRuntime,\n  LinearGradient,\n  Pattern,\n  RadialGradient,\n  Rect,\n  GradientType,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport function getPattern(\n  pattern: Pattern,\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n): CanvasPattern {\n  let $offscreenCanvas: HTMLCanvasElement;\n  let dpr: number;\n  if ((pattern.image as Rect).nodeName === 'rect') {\n    const { width, height } = (pattern.image as Rect).parsedStyle;\n    dpr = canvasContext.contextService.getDPR();\n    const { offscreenCanvas } = canvasContext.config;\n    $offscreenCanvas = runtime.offscreenCanvasCreator.getOrCreateCanvas(\n      offscreenCanvas,\n    ) as HTMLCanvasElement;\n\n    $offscreenCanvas.width = width * dpr;\n    $offscreenCanvas.height = height * dpr;\n\n    const offscreenCanvasContext =\n      runtime.offscreenCanvasCreator.getOrCreateContext(\n        offscreenCanvas,\n      ) as CanvasRenderingContext2D;\n\n    const renderState: RenderState = {\n      restoreStack: [],\n      prevObject: null,\n      currentContext: new Map(),\n    };\n\n    // offscreenCanvasContext.scale(1 / dpr, 1 / dpr);\n\n    (pattern.image as Rect).forEach((object: DisplayObject) => {\n      plugin.renderDisplayObject(\n        object,\n        offscreenCanvasContext,\n        canvasContext,\n        renderState,\n        runtime,\n      );\n    });\n\n    renderState.restoreStack.forEach(() => {\n      offscreenCanvasContext.restore();\n    });\n  }\n\n  const canvasPattern = imagePool.getOrCreatePatternSync(\n    object,\n    pattern,\n    context,\n    $offscreenCanvas,\n    dpr,\n    object.getGeometryBounds().min,\n    () => {\n      // set dirty rectangle flag\n      object.renderable.dirty = true;\n      canvasContext.renderingService.dirtify();\n    },\n  );\n\n  return canvasPattern;\n}\n\nexport function getColor(\n  parsedColor: CSSGradientValue,\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  imagePool: ImagePool,\n) {\n  let color: CanvasGradient | string;\n\n  if (\n    parsedColor.type === GradientType.LinearGradient ||\n    parsedColor.type === GradientType.RadialGradient\n  ) {\n    const bounds = object.getGeometryBounds();\n    const width = (bounds && bounds.halfExtents[0] * 2) || 1;\n    const height = (bounds && bounds.halfExtents[1] * 2) || 1;\n    const min = (bounds && bounds.min) || [0, 0];\n    color = imagePool.getOrCreateGradient(\n      {\n        type: parsedColor.type,\n        ...(parsedColor.value as LinearGradient & RadialGradient),\n        min: min as [number, number],\n        width,\n        height,\n      },\n      context,\n    );\n  }\n\n  return color;\n}\n","import {\n  CanvasContext,\n  CSSRGB,\n  DisplayObject,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  isPattern,\n  Shape,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\nimport type { StyleRenderer } from './interfaces';\nimport { getColor, getPattern } from './helper';\n\nconst SHADOW_NUMBER_STYLE = [\n  'shadowBlur',\n  'shadowOffsetX',\n  'shadowOffsetY',\n] as const;\nconst STROKE_STYLE = ['lineCap', 'lineJoin', 'miterLimit'] as const;\nexport const DEFAULT_STYLE = {\n  // common\n  globalAlpha: 1,\n  shadowBlur: 0,\n  shadowOffsetX: 0,\n  shadowOffsetY: 0,\n  shadowColor: '#000',\n  filter: 'none' as const,\n  globalCompositeOperation: 'source-over' as const,\n\n  // stroke/fill\n  strokeStyle: '#000',\n  strokeOpacity: 1,\n  lineWidth: 1,\n  lineDash: [],\n  lineDashOffset: 0,\n  lineCap: 'butt' as const,\n  lineJoin: 'miter' as const,\n  miterLimit: 10,\n  fillStyle: '#000',\n  fillOpacity: 1,\n\n  // image\n};\n\nconst defaultParsedStyle = {} as ParsedBaseStyleProps;\n\n/**\n * Updating the canvas context is an expensive operation. The state of the context is cached and the actual update operation is performed only when the cache is not hit.\n *\n * In any case, the previous value is returned, which is convenient for temporarily updating the context and restoring it later.\n */\nfunction updateContextIfNotHitCache<\n  K extends keyof CanvasRenderingContext2D | 'lineDash',\n  V = unknown,\n>(context: CanvasRenderingContext2D, key: K, value: V, cache: Map<K, unknown>) {\n  const prevValue = (\n    cache.has(key)\n      ? cache.get(key)\n      : DEFAULT_STYLE[key as keyof typeof DEFAULT_STYLE]\n  ) as V;\n\n  if (prevValue !== value) {\n    // console.log('not hit cache', key, value, prevValue, cache);\n    if (key === 'lineDash') {\n      context.setLineDash(value as number[]);\n    } else {\n      // @ts-ignore\n      context[key] = value;\n    }\n    cache.set(key, value);\n  }\n\n  return prevValue;\n}\n\nexport class OptimizedDefaultRenderer implements StyleRenderer {\n  constructor(public imagePool: ImagePool) {}\n\n  applyAttributesToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n  ) {}\n\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedBaseStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {}\n\n  // #region common style\n  private applyCommonStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    // const dpr = object.ownerDocument.defaultView.getContextService().getDPR();\n    const prevStyle = forceUpdate\n      ? defaultParsedStyle\n      : renderState.prevObject.parsedStyle;\n    const style = object.parsedStyle;\n\n    if (forceUpdate || style.opacity !== prevStyle.opacity) {\n      updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        !isNil(style.opacity) ? style.opacity : DEFAULT_STYLE.globalAlpha,\n        renderState.currentContext,\n      );\n    }\n\n    // TODO blend prop\n    // @ts-ignore\n    if (forceUpdate || style.blend !== prevStyle.blend) {\n      updateContextIfNotHitCache(\n        context,\n        'globalCompositeOperation',\n        // @ts-ignore\n        !isNil(style.blend)\n          ? // @ts-ignore\n            style.blend\n          : DEFAULT_STYLE.globalCompositeOperation,\n        renderState.currentContext,\n      );\n    }\n  }\n  // #endregion common style\n\n  // #region stroke/fill style\n  private applyStrokeFillStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    const prevStyle = forceUpdate\n      ? defaultParsedStyle\n      : renderState.prevObject.parsedStyle;\n    const style = object.parsedStyle;\n    const { lineWidth = DEFAULT_STYLE.lineWidth } = style;\n    const hasFill = style.fill && !(style.fill as CSSRGB).isNone;\n    const hasStroke =\n      style.stroke && !(style.stroke as CSSRGB).isNone && lineWidth > 0;\n\n    if (hasStroke) {\n      if (\n        forceUpdate ||\n        object.attributes.stroke !== renderState.prevObject.attributes.stroke\n      ) {\n        const value =\n          !isNil(style.stroke) &&\n          !Array.isArray(style.stroke) &&\n          !(style.stroke as CSSRGB).isNone\n            ? object.attributes.stroke\n            : DEFAULT_STYLE.strokeStyle;\n\n        updateContextIfNotHitCache(\n          context,\n          'strokeStyle',\n          value,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineWidth !== prevStyle.lineWidth) {\n        updateContextIfNotHitCache(\n          context,\n          'lineWidth',\n          !isNil(style.lineWidth) ? style.lineWidth : DEFAULT_STYLE.lineWidth,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineDash !== prevStyle.lineDash) {\n        updateContextIfNotHitCache(\n          context,\n          'lineDash',\n          style.lineDash || DEFAULT_STYLE.lineDash,\n          renderState.currentContext,\n        );\n      }\n\n      if (forceUpdate || style.lineDashOffset !== prevStyle.lineDashOffset) {\n        updateContextIfNotHitCache(\n          context,\n          'lineDashOffset',\n          !isNil(style.lineDashOffset)\n            ? style.lineDashOffset\n            : DEFAULT_STYLE.lineDashOffset,\n          renderState.currentContext,\n        );\n      }\n\n      for (let i = 0; i < STROKE_STYLE.length; i++) {\n        const styleName = STROKE_STYLE[i];\n        if (forceUpdate || style[styleName] !== prevStyle[styleName]) {\n          updateContextIfNotHitCache(\n            context,\n            styleName,\n            !isNil(style[styleName])\n              ? style[styleName]\n              : DEFAULT_STYLE[styleName],\n            renderState.currentContext,\n          );\n        }\n      }\n    }\n\n    if (\n      hasFill &&\n      (forceUpdate ||\n        object.attributes.fill !== renderState.prevObject.attributes.fill)\n    ) {\n      const value =\n        !isNil(style.fill) &&\n        !Array.isArray(style.fill) &&\n        !(style.fill as CSSRGB).isNone\n          ? object.attributes.fill\n          : DEFAULT_STYLE.fillStyle;\n\n      updateContextIfNotHitCache(\n        context,\n        'fillStyle',\n        value,\n        renderState.currentContext,\n      );\n    }\n  }\n  // #endregion stroke/fill style\n\n  applyStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    forceUpdate: boolean,\n    renderState: RenderState,\n  ) {\n    const nodeName = object.nodeName as Shape;\n\n    this.applyCommonStyleToContext(context, object, forceUpdate, renderState);\n\n    if (nodeName === Shape.IMAGE) {\n      //\n    } else {\n      this.applyStrokeFillStyleToContext(\n        context,\n        object,\n        forceUpdate,\n        renderState,\n      );\n    }\n  }\n\n  applyShadowAndFilterStyleToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    hasShadow: boolean,\n    renderState: RenderState,\n  ) {\n    const style = object.parsedStyle;\n\n    if (hasShadow) {\n      updateContextIfNotHitCache(\n        context,\n        'shadowColor',\n        style.shadowColor.toString(),\n        renderState.currentContext,\n      );\n      for (let i = 0; i < SHADOW_NUMBER_STYLE.length; i++) {\n        const styleName = SHADOW_NUMBER_STYLE[i];\n        updateContextIfNotHitCache(\n          context,\n          styleName,\n          style[styleName] || DEFAULT_STYLE[styleName],\n          renderState.currentContext,\n        );\n      }\n    }\n\n    if (style.filter && style.filter.length) {\n      updateContextIfNotHitCache(\n        context,\n        'filter',\n        // use raw filter string\n        object.attributes.filter,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  clearShadowAndFilterStyleForContext(\n    context: CanvasRenderingContext2D,\n    hasShadow: boolean,\n    hasFilter: boolean,\n    renderState: RenderState,\n    onlyClearShadowFilter = false,\n  ) {\n    if (hasShadow) {\n      updateContextIfNotHitCache(\n        context,\n        'shadowColor',\n        DEFAULT_STYLE.shadowColor,\n        renderState.currentContext,\n      );\n      for (let i = 0; i < SHADOW_NUMBER_STYLE.length; i++) {\n        const styleName = SHADOW_NUMBER_STYLE[i];\n        updateContextIfNotHitCache(\n          context,\n          styleName,\n          DEFAULT_STYLE[styleName],\n          renderState.currentContext,\n        );\n      }\n    }\n\n    if (hasFilter) {\n      if (hasShadow && onlyClearShadowFilter) {\n        // save drop-shadow filter\n        const oldFilter = context.filter;\n        if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n          updateContextIfNotHitCache(\n            context,\n            'filter',\n            oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() ||\n              DEFAULT_STYLE.filter,\n            renderState.currentContext,\n          );\n        }\n      } else {\n        updateContextIfNotHitCache(\n          context,\n          'filter',\n          DEFAULT_STYLE.filter,\n          renderState.currentContext,\n        );\n      }\n    }\n  }\n\n  fillToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const { fill, fillRule } = object.parsedStyle;\n    let resetStyle = null as unknown;\n\n    if (Array.isArray(fill) && fill.length > 0) {\n      fill.forEach((gradient) => {\n        const prevStyle = updateContextIfNotHitCache(\n          context,\n          'fillStyle',\n          getColor(gradient, object, context, this.imagePool),\n          renderState.currentContext,\n        );\n        resetStyle = resetStyle ?? prevStyle;\n\n        if (fillRule) {\n          context.fill(fillRule);\n        } else {\n          context.fill();\n        }\n      });\n    } else {\n      if (isPattern(fill)) {\n        const pattern = getPattern(\n          fill,\n          object,\n          context,\n          object.ownerDocument.defaultView.context,\n          plugin,\n          runtime,\n          this.imagePool,\n        );\n        if (pattern) {\n          context.fillStyle = pattern;\n          resetStyle = true;\n        }\n      }\n\n      if (fillRule) {\n        context.fill(fillRule);\n      } else {\n        context.fill();\n      }\n    }\n\n    if (resetStyle !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'fillStyle',\n        resetStyle,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  strokeToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const { stroke } = object.parsedStyle;\n    let resetStyle = null as unknown;\n\n    if (Array.isArray(stroke) && stroke.length > 0) {\n      stroke.forEach((gradient) => {\n        const prevStyle = updateContextIfNotHitCache(\n          context,\n          'strokeStyle',\n          getColor(gradient, object, context, this.imagePool),\n          renderState.currentContext,\n        );\n        resetStyle = resetStyle ?? prevStyle;\n\n        context.stroke();\n      });\n    } else {\n      if (isPattern(stroke)) {\n        const pattern = getPattern(\n          stroke,\n          object,\n          context,\n          object.ownerDocument.defaultView.context,\n          plugin,\n          runtime,\n          this.imagePool,\n        );\n        if (pattern) {\n          const prevStyle = updateContextIfNotHitCache(\n            context,\n            'strokeStyle',\n            pattern,\n            renderState.currentContext,\n          );\n          resetStyle = resetStyle ?? prevStyle;\n        }\n      }\n\n      context.stroke();\n    }\n\n    if (resetStyle !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'strokeStyle',\n        resetStyle,\n        renderState.currentContext,\n      );\n    }\n  }\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const nodeName = object.nodeName as Shape;\n    const style = object.parsedStyle;\n    const {\n      opacity = DEFAULT_STYLE.globalAlpha,\n      fillOpacity = DEFAULT_STYLE.fillOpacity,\n      strokeOpacity = DEFAULT_STYLE.strokeOpacity,\n      lineWidth = DEFAULT_STYLE.lineWidth,\n    } = style;\n\n    const hasFill = style.fill && !(style.fill as CSSRGB).isNone;\n    const hasStroke =\n      style.stroke && !(style.stroke as CSSRGB).isNone && lineWidth > 0;\n\n    if (!hasFill && !hasStroke) {\n      return;\n    }\n\n    const hasShadow = !isNil(style.shadowColor) && style.shadowBlur > 0;\n    const isInnerShadow = style.shadowType === 'inner';\n    const isFillTransparent = (style.fill as CSSRGB)?.alpha === 0;\n    const hasFilter = !!(style.filter && style.filter.length);\n    // Shadows can only be applied to fill() or stroke(), the default is fill()\n    const shouldDrawShadowWithStroke =\n      hasShadow &&\n      hasStroke &&\n      (nodeName === Shape.PATH ||\n        nodeName === Shape.LINE ||\n        nodeName === Shape.POLYLINE ||\n        isFillTransparent ||\n        isInnerShadow);\n\n    // TODO https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/paint-order\n\n    let originGlobalAlpha: number | null = null;\n\n    if (hasFill) {\n      if (!shouldDrawShadowWithStroke) {\n        this.applyShadowAndFilterStyleToContext(\n          context,\n          object,\n          hasShadow,\n          renderState,\n        );\n      }\n\n      const updateOpacity = opacity * fillOpacity;\n\n      originGlobalAlpha = updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        updateOpacity,\n        renderState.currentContext,\n      );\n\n      this.fillToContext(context, object, renderState, plugin, runtime);\n\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilterStyleForContext(\n          context,\n          hasShadow,\n          hasFilter,\n          renderState,\n        );\n      }\n    }\n    if (hasStroke) {\n      let clearShadowAndFilter = false;\n      const updateOpacity = opacity * strokeOpacity;\n      const prevOpacity = updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        updateOpacity,\n        renderState.currentContext,\n      );\n      originGlobalAlpha = hasFill ? originGlobalAlpha : prevOpacity;\n\n      if (shouldDrawShadowWithStroke) {\n        this.applyShadowAndFilterStyleToContext(\n          context,\n          object,\n          hasShadow,\n          renderState,\n        );\n        clearShadowAndFilter = true;\n\n        if (isInnerShadow) {\n          const originBlend = context.globalCompositeOperation;\n          context.globalCompositeOperation = 'source-atop';\n\n          this.strokeToContext(context, object, renderState, plugin, runtime);\n\n          context.globalCompositeOperation = originBlend;\n          this.clearShadowAndFilterStyleForContext(\n            context,\n            hasShadow,\n            hasFilter,\n            renderState,\n            true,\n          );\n        }\n      }\n\n      this.strokeToContext(context, object, renderState, plugin, runtime);\n\n      if (clearShadowAndFilter) {\n        this.clearShadowAndFilterStyleForContext(\n          context,\n          hasShadow,\n          hasFilter,\n          renderState,\n        );\n      }\n    }\n\n    // clear\n    if (originGlobalAlpha !== null) {\n      updateContextIfNotHitCache(\n        context,\n        'globalAlpha',\n        originGlobalAlpha,\n        renderState.currentContext,\n      );\n    }\n  }\n}\n","import {\n  CanvasContext,\n  CSSGradientValue,\n  CSSRGB,\n  DisplayObject,\n  GlobalRuntime,\n  ParsedBaseStyleProps,\n  Pattern,\n  isPattern,\n  Shape,\n} from '@antv/g-lite';\nimport type { ImagePool } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport { CanvasRendererPlugin } from '../../CanvasRendererPlugin';\nimport { OptimizedDefaultRenderer, DEFAULT_STYLE } from './OptimizedDefault';\nimport { getColor, getPattern } from './helper';\n\nexport class DefaultRenderer extends OptimizedDefaultRenderer {\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedBaseStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    const {\n      fill,\n      fillRule,\n      opacity = 1,\n      fillOpacity = 1,\n      stroke,\n      strokeOpacity = 1,\n      lineWidth = 1,\n      lineCap,\n      lineJoin,\n      shadowType,\n      shadowColor,\n      shadowBlur,\n      filter,\n      miterLimit,\n    } = parsedStyle;\n    const hasFill = fill && !(fill as CSSRGB).isNone;\n    const hasStroke = stroke && !(stroke as CSSRGB).isNone && lineWidth > 0;\n\n    const isFillTransparent = (fill as CSSRGB)?.alpha === 0;\n    const hasFilter = !!(filter && filter.length);\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    const nodeName = object.nodeName as Shape;\n    const isInnerShadow = shadowType === 'inner';\n    const shouldDrawShadowWithStroke =\n      hasStroke &&\n      hasShadow &&\n      (nodeName === Shape.PATH ||\n        nodeName === Shape.LINE ||\n        nodeName === Shape.POLYLINE ||\n        isFillTransparent ||\n        isInnerShadow);\n\n    if (hasFill) {\n      context.globalAlpha = opacity * fillOpacity;\n\n      if (!shouldDrawShadowWithStroke) {\n        setShadowAndFilter(object, context, hasShadow);\n      }\n\n      applyFill(\n        context,\n        object,\n        fill,\n        fillRule,\n        canvasContext,\n        plugin,\n        runtime,\n        this.imagePool,\n      );\n\n      if (!shouldDrawShadowWithStroke) {\n        this.clearShadowAndFilter(context, hasFilter, hasShadow);\n      }\n    }\n\n    if (hasStroke) {\n      context.globalAlpha = opacity * strokeOpacity;\n      context.lineWidth = lineWidth;\n      if (!isNil(miterLimit)) {\n        context.miterLimit = miterLimit;\n      }\n\n      if (!isNil(lineCap)) {\n        context.lineCap = lineCap;\n      }\n\n      if (!isNil(lineJoin)) {\n        context.lineJoin = lineJoin;\n      }\n\n      if (shouldDrawShadowWithStroke) {\n        if (isInnerShadow) {\n          context.globalCompositeOperation = 'source-atop';\n        }\n        setShadowAndFilter(object, context, true);\n\n        if (isInnerShadow) {\n          applyStroke(\n            context,\n            object,\n            stroke,\n            canvasContext,\n            plugin,\n            runtime,\n            this.imagePool,\n          );\n          context.globalCompositeOperation =\n            DEFAULT_STYLE.globalCompositeOperation;\n          this.clearShadowAndFilter(context, hasFilter, true);\n        }\n      }\n\n      applyStroke(\n        context,\n        object,\n        stroke,\n        canvasContext,\n        plugin,\n        runtime,\n        this.imagePool,\n      );\n    }\n  }\n\n  private clearShadowAndFilter(\n    context: CanvasRenderingContext2D,\n    hasFilter: boolean,\n    hasShadow: boolean,\n  ) {\n    if (hasShadow) {\n      context.shadowColor = 'transparent';\n      context.shadowBlur = 0;\n    }\n\n    if (hasFilter) {\n      // save drop-shadow filter\n      const oldFilter = context.filter;\n      if (!isNil(oldFilter) && oldFilter.indexOf('drop-shadow') > -1) {\n        context.filter =\n          oldFilter.replace(/drop-shadow\\([^)]*\\)/, '').trim() || 'none';\n      }\n    }\n  }\n}\n\n/**\n * apply before fill and stroke but only once\n */\nexport function setShadowAndFilter(\n  object: DisplayObject,\n  context: CanvasRenderingContext2D,\n  hasShadow: boolean,\n) {\n  const { filter, shadowColor, shadowBlur, shadowOffsetX, shadowOffsetY } =\n    object.parsedStyle;\n\n  if (filter && filter.length) {\n    // use raw filter string\n    context.filter = object.style.filter;\n  }\n\n  if (hasShadow) {\n    context.shadowColor = shadowColor.toString();\n    context.shadowBlur = shadowBlur || 0;\n    context.shadowOffsetX = shadowOffsetX || 0;\n    context.shadowOffsetY = shadowOffsetY || 0;\n  }\n}\n\nexport function applyFill(\n  context: CanvasRenderingContext2D,\n  object: DisplayObject,\n  fill: CSSRGB | CSSGradientValue[] | Pattern,\n  fillRule: 'nonzero' | 'evenodd',\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n  skipFill = false,\n) {\n  if (Array.isArray(fill)) {\n    fill.forEach((gradient) => {\n      context.fillStyle = getColor(gradient, object, context, imagePool);\n      if (!skipFill) {\n        fillRule ? context.fill(fillRule) : context.fill();\n      }\n    });\n  } else {\n    if (isPattern(fill)) {\n      context.fillStyle = getPattern(\n        fill,\n        object,\n        context,\n        canvasContext,\n        plugin,\n        runtime,\n        imagePool,\n      );\n    }\n    if (!skipFill) {\n      fillRule ? context.fill(fillRule) : context.fill();\n    }\n  }\n}\n\nexport function applyStroke(\n  context: CanvasRenderingContext2D,\n  object: DisplayObject,\n  stroke: CSSRGB | CSSGradientValue[] | Pattern,\n  canvasContext: CanvasContext,\n  plugin: CanvasRendererPlugin,\n  runtime: GlobalRuntime,\n  imagePool: ImagePool,\n  skipStroke = false,\n) {\n  if (Array.isArray(stroke)) {\n    stroke.forEach((gradient) => {\n      context.strokeStyle = getColor(gradient, object, context, imagePool);\n      if (!skipStroke) {\n        context.stroke();\n      }\n    });\n  } else {\n    if (isPattern(stroke)) {\n      context.strokeStyle = getPattern(\n        stroke,\n        object,\n        context,\n        canvasContext,\n        plugin,\n        runtime,\n        imagePool,\n      );\n    }\n    if (!skipStroke) {\n      context.stroke();\n    }\n  }\n}\n","import { vec3, mat4 } from 'gl-matrix';\n\n/**\n * 判断两个点是否重合，点坐标的格式为 [x, y]\n */\nexport function isSamePoint(\n  point1: [number, number],\n  point2: [number, number],\n) {\n  return point1[0] === point2[0] && point1[1] === point2[1];\n}\n\nexport function calculateOverlapRect<\n  Rect extends [number, number, number, number],\n>(rect1: Rect, rect2: Rect): null | Rect {\n  const [x1, y1, w1, h1] = rect1;\n  const [x2, y2, w2, h2] = rect2;\n\n  // 计算重叠区域的左上角和右下角\n  const overlapLeft = Math.max(x1, x2);\n  const overlapTop = Math.max(y1, y2);\n  const overlapRight = Math.min(x1 + w1, x2 + w2);\n  const overlapBottom = Math.min(y1 + h1, y2 + h2);\n\n  if (overlapRight <= overlapLeft || overlapBottom <= overlapTop) {\n    return null;\n  }\n\n  return [\n    overlapLeft,\n    overlapTop,\n    overlapRight - overlapLeft,\n    overlapBottom - overlapTop,\n  ] as Rect;\n}\n\nexport function transformRect<Rect extends [number, number, number, number]>(\n  rect: Rect,\n  matrix: mat4,\n): Rect {\n  const tl = vec3.transformMat4(vec3.create(), [rect[0], rect[1], 0], matrix);\n  const tr = vec3.transformMat4(\n    vec3.create(),\n    [rect[0] + rect[2], rect[1], 0],\n    matrix,\n  );\n  const bl = vec3.transformMat4(\n    vec3.create(),\n    [rect[0], rect[1] + rect[3], 0],\n    matrix,\n  );\n  const br = vec3.transformMat4(\n    vec3.create(),\n    [rect[0] + rect[2], rect[1] + rect[3], 0],\n    matrix,\n  );\n\n  return [\n    Math.min(tl[0], tr[0], bl[0], br[0]),\n    Math.min(tl[1], tr[1], bl[1], br[1]),\n    Math.max(tl[0], tr[0], bl[0], br[0]) - Math.min(tl[0], tr[0], bl[0], br[0]),\n    Math.max(tl[1], tr[1], bl[1], br[1]) - Math.min(tl[1], tr[1], bl[1], br[1]),\n  ] as Rect;\n}\n","import type {\n  DisplayObject,\n  ParsedImageStyleProps,\n  GlobalRuntime,\n} from '@antv/g-lite';\nimport { ImagePool, type ImageCache } from '@antv/g-plugin-image-loader';\nimport { isNil } from '@antv/util';\nimport { mat4 } from 'gl-matrix';\nimport { transformRect, calculateOverlapRect } from '../../utils/math';\nimport { DefaultRenderer, setShadowAndFilter } from './Default';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport class ImageRenderer extends DefaultRenderer {\n  static renderFull(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      image: HTMLImageElement;\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    context.drawImage(\n      data.image,\n      Math.floor(data.drawRect[0]),\n      Math.floor(data.drawRect[1]),\n      Math.ceil(data.drawRect[2]),\n      Math.ceil(data.drawRect[3]),\n    );\n  }\n\n  private renderDownSampled(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      src: string | HTMLImageElement;\n      imageCache: ImageCache;\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    const { src, imageCache } = data;\n\n    if (!imageCache.downSampled) {\n      this.imagePool\n        .createDownSampledImage(src, object)\n        .then((res) => {\n          // rerender\n          // object.dirty();\n          object.renderable.dirty = true;\n          object.ownerDocument.defaultView.context.renderingService.dirtify();\n        })\n        .catch(() => {\n          //\n        });\n\n      return;\n    }\n\n    context.drawImage(\n      imageCache.downSampled,\n      Math.floor(data.drawRect[0]),\n      Math.floor(data.drawRect[1]),\n      Math.ceil(data.drawRect[2]),\n      Math.ceil(data.drawRect[3]),\n    );\n  }\n\n  renderTile(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n    data: {\n      src: string | HTMLImageElement;\n      imageCache: ImageCache;\n      imageRect: [number, number, number, number];\n      drawRect: [number, number, number, number];\n    },\n  ) {\n    const { src, imageCache, imageRect, drawRect } = data;\n    const { size: originalSize } = imageCache;\n    const { a, b, c, d, e, f } = context.getTransform();\n\n    context.resetTransform();\n\n    if (!imageCache?.gridSize) {\n      this.imagePool\n        .createImageTiles(\n          src,\n          [],\n          () => {\n            // rerender\n            // object.dirty();\n            object.renderable.dirty = true;\n            object.ownerDocument.defaultView.context.renderingService.dirtify();\n          },\n          object,\n        )\n        .catch(() => {\n          //\n        });\n\n      return;\n    }\n\n    const scaleToOrigin = [\n      originalSize[0] / imageRect[2],\n      originalSize[1] / imageRect[3],\n    ];\n    const scaledTileSize = [\n      imageCache.tileSize[0] / scaleToOrigin[0],\n      imageCache.tileSize[1] / scaleToOrigin[1],\n    ];\n    const [startTileX, endTileX] = [\n      Math.floor((drawRect[0] - imageRect[0]) / scaledTileSize[0]),\n      Math.ceil((drawRect[0] + drawRect[2] - imageRect[0]) / scaledTileSize[0]),\n    ];\n    const [startTileY, endTileY] = [\n      Math.floor((drawRect[1] - imageRect[1]) / scaledTileSize[1]),\n      Math.ceil((drawRect[1] + drawRect[3] - imageRect[1]) / scaledTileSize[1]),\n    ];\n\n    for (let tileY = startTileY; tileY <= endTileY; tileY++) {\n      for (let tileX = startTileX; tileX <= endTileX; tileX++) {\n        const item = imageCache.tiles[tileY][tileX];\n\n        if (item) {\n          const tileRect = [\n            Math.floor(imageRect[0] + item.tileX * scaledTileSize[0]),\n            Math.floor(imageRect[1] + item.tileY * scaledTileSize[1]),\n            Math.ceil(scaledTileSize[0]),\n            Math.ceil(scaledTileSize[1]),\n          ];\n\n          context.drawImage(\n            item.data,\n            tileRect[0],\n            tileRect[1],\n            tileRect[2],\n            tileRect[3],\n          );\n        }\n      }\n    }\n\n    context.setTransform(a, b, c, d, e, f);\n  }\n\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedImageStyleProps,\n    object: DisplayObject,\n  ) {\n    const {\n      x = 0,\n      y = 0,\n      width,\n      height,\n      src,\n      shadowColor,\n      shadowBlur,\n    } = parsedStyle;\n\n    const imageCache = this.imagePool.getImageSync(src, object);\n    const image = imageCache?.img;\n    let iw = width;\n    let ih = height;\n\n    if (!image) {\n      return;\n    }\n\n    iw ||= image.width;\n    ih ||= image.height;\n\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n\n    // node-canvas will throw the following err:\n    // Error: Image given has not completed loading\n    try {\n      const { width: viewWidth, height: viewHeight } =\n        object.ownerDocument.defaultView.getContextService().getDomElement();\n\n      const currentTransform = context.getTransform();\n      const { a, b, c, d, e, f } = currentTransform;\n      // 构建 mat4 矩阵\n      // prettier-ignore\n      const transformMatrix = mat4.fromValues(\n          a, c, 0, 0,\n          b, d, 0, 0,\n          0, 0, 1, 0,\n          e, f, 0, 1,\n        );\n      const imageRect = transformRect([x, y, iw, ih], transformMatrix);\n      const drawRect = calculateOverlapRect(\n        [0, 0, viewWidth, viewHeight],\n        imageRect,\n      );\n\n      if (!drawRect) {\n        return;\n      }\n\n      if (\n        !object.ownerDocument.defaultView.getConfig()\n          .enableLargeImageOptimization\n      ) {\n        ImageRenderer.renderFull(context, parsedStyle, object, {\n          image,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      const sizeOfOrigin = imageRect[2] / imageCache.size[0];\n\n      if (sizeOfOrigin < (imageCache.downSamplingRate || 0.5)) {\n        this.renderDownSampled(context, parsedStyle, object, {\n          src,\n          imageCache,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      if (!ImagePool.isSupportTile) {\n        ImageRenderer.renderFull(context, parsedStyle, object, {\n          image,\n          drawRect: [x, y, iw, ih],\n        });\n\n        return;\n      }\n\n      this.renderTile(context, parsedStyle, object, {\n        src,\n        imageCache,\n        imageRect,\n        drawRect,\n      });\n    } catch {}\n  }\n\n  // ---\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    this.render(context, object.parsedStyle as ParsedImageStyleProps, object);\n  }\n}\n","import {\n  type CSSRGB,\n  type CanvasContext,\n  type DisplayObject,\n  type GlobalRuntime,\n  type ParsedTextStyleProps,\n  type Rectangle,\n  CSSGradientValue,\n  Pattern,\n} from '@antv/g-lite';\nimport { isNil } from '@antv/util';\nimport {\n  DefaultRenderer,\n  applyFill,\n  applyStroke,\n  setShadowAndFilter,\n} from './Default';\nimport {\n  CanvasRendererPlugin,\n  type RenderState,\n} from '../../CanvasRendererPlugin';\n\nexport class TextRenderer extends DefaultRenderer {\n  render(\n    context: CanvasRenderingContext2D,\n    parsedStyle: ParsedTextStyleProps,\n    object: DisplayObject,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    // Trigger text geometry calculation.\n    object.getBounds();\n    const {\n      lineWidth = 1,\n      textAlign = 'start',\n      textBaseline = 'alphabetic',\n      lineJoin = 'miter',\n      miterLimit = 10,\n      letterSpacing = 0,\n      stroke,\n      fill,\n      fillRule,\n      fillOpacity = 1,\n      strokeOpacity = 1,\n      opacity = 1,\n      metrics,\n      x = 0,\n      y = 0,\n      dx,\n      dy,\n      shadowColor,\n      shadowBlur,\n    } = parsedStyle;\n\n    const { font, lines, height, lineHeight, lineMetrics } = metrics;\n\n    context.font = font;\n    context.lineWidth = lineWidth;\n    context.textAlign = textAlign === 'middle' ? 'center' : textAlign;\n\n    let formattedTextBaseline = textBaseline;\n    if (formattedTextBaseline === 'alphabetic') {\n      formattedTextBaseline = 'bottom';\n    }\n\n    context.lineJoin = lineJoin;\n    if (!isNil(miterLimit)) {\n      context.miterLimit = miterLimit;\n    }\n\n    let linePositionY = y;\n    // handle vertical text baseline\n    if (textBaseline === 'middle') {\n      linePositionY += -height / 2 - lineHeight / 2;\n    } else if (\n      textBaseline === 'bottom' ||\n      textBaseline === 'alphabetic' ||\n      textBaseline === 'ideographic'\n    ) {\n      linePositionY += -height;\n    } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n      linePositionY += -lineHeight;\n    }\n\n    // account for dx & dy\n    const offsetX = x + (dx || 0);\n    linePositionY += dy || 0;\n\n    if (lines.length === 1) {\n      if (formattedTextBaseline === 'bottom') {\n        formattedTextBaseline = 'middle';\n        linePositionY -= 0.5 * height;\n      } else if (formattedTextBaseline === 'top') {\n        formattedTextBaseline = 'middle';\n        linePositionY += 0.5 * height;\n      }\n    }\n    context.textBaseline = formattedTextBaseline;\n\n    const hasShadow = !isNil(shadowColor) && shadowBlur > 0;\n    setShadowAndFilter(object, context, hasShadow);\n\n    // draw lines line by line\n    for (let i = 0; i < lines.length; i++) {\n      const linePositionX = lineWidth / 2 + offsetX;\n      linePositionY += lineHeight;\n\n      // no need to re-position X, cause we already set text align\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textAlign\n      if (!isNil(stroke) && !(stroke as CSSRGB).isNone && lineWidth) {\n        this.drawLetterSpacing(\n          context,\n          object,\n          lines[i],\n          lineMetrics[i],\n          textAlign,\n          linePositionX,\n          linePositionY,\n          letterSpacing,\n          fill,\n          fillRule,\n          fillOpacity,\n          stroke,\n          strokeOpacity,\n          opacity,\n          true,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      if (!isNil(fill)) {\n        this.drawLetterSpacing(\n          context,\n          object,\n          lines[i],\n          lineMetrics[i],\n          textAlign,\n          linePositionX,\n          linePositionY,\n          letterSpacing,\n          fill,\n          fillRule,\n          fillOpacity,\n          stroke,\n          strokeOpacity,\n          opacity,\n          false,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n    }\n  }\n\n  private drawLetterSpacing(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    lineMetrics: Rectangle,\n    textAlign: CanvasTextAlign | 'middle',\n    x: number,\n    y: number,\n    letterSpacing: number,\n    fill: CSSRGB | CSSGradientValue[] | Pattern,\n    fillRule: 'nonzero' | 'evenodd',\n    fillOpacity: number | undefined,\n    stroke: CSSRGB | CSSGradientValue[] | Pattern,\n    strokeOpacity: number | undefined,\n    opacity: number | undefined,\n    isStroke: boolean,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ): void {\n    // letterSpacing of 0 means normal, render all texts directly\n    if (letterSpacing === 0) {\n      if (isStroke) {\n        this.strokeText(\n          context,\n          object,\n          text,\n          x,\n          y,\n          stroke,\n          strokeOpacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      } else {\n        this.fillText(\n          context,\n          object,\n          text,\n          x,\n          y,\n          fill,\n          fillRule,\n          fillOpacity,\n          opacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      return;\n    }\n\n    // draw text using left align\n    const currentTextAlign = context.textAlign;\n    context.textAlign = 'left';\n\n    let currentPosition = x;\n    if (textAlign === 'center' || textAlign === 'middle') {\n      currentPosition = x - lineMetrics.width / 2;\n    } else if (textAlign === 'right' || textAlign === 'end') {\n      currentPosition = x - lineMetrics.width;\n    }\n\n    const stringArray = Array.from(text);\n    let previousWidth = context.measureText(text).width;\n    let currentWidth = 0;\n    for (let i = 0; i < stringArray.length; ++i) {\n      const currentChar = stringArray[i];\n      if (isStroke) {\n        this.strokeText(\n          context,\n          object,\n          currentChar,\n          currentPosition,\n          y,\n          stroke,\n          strokeOpacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      } else {\n        this.fillText(\n          context,\n          object,\n          currentChar,\n          currentPosition,\n          y,\n          fill,\n          fillRule,\n          fillOpacity,\n          opacity,\n          canvasContext,\n          plugin,\n          runtime,\n        );\n      }\n      currentWidth = context.measureText(text.substring(i + 1)).width;\n      currentPosition += previousWidth - currentWidth + letterSpacing;\n      previousWidth = currentWidth;\n    }\n\n    context.textAlign = currentTextAlign;\n  }\n\n  private fillText(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    x: number,\n    y: number,\n    fill: CSSRGB | CSSGradientValue[] | Pattern,\n    fillRule: 'nonzero' | 'evenodd',\n    fillOpacity: number | undefined,\n    opacity: number | undefined,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    applyFill(\n      context,\n      object,\n      fill,\n      fillRule,\n      canvasContext,\n      plugin,\n      runtime,\n      this.imagePool,\n      true,\n    );\n\n    let currentGlobalAlpha: number;\n    const applyOpacity = !isNil(fillOpacity) && fillOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = fillOpacity * opacity;\n    }\n    context.fillText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  }\n\n  private strokeText(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    text: string,\n    x: number,\n    y: number,\n    stroke: CSSRGB | CSSGradientValue[] | Pattern,\n    strokeOpacity: number | undefined,\n    canvasContext: CanvasContext,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    applyStroke(\n      context,\n      object,\n      stroke,\n      canvasContext,\n      plugin,\n      runtime,\n      this.imagePool,\n      true,\n    );\n\n    let currentGlobalAlpha: number;\n    const applyOpacity = !isNil(strokeOpacity) && strokeOpacity !== 1;\n    if (applyOpacity) {\n      currentGlobalAlpha = context.globalAlpha;\n      context.globalAlpha = strokeOpacity!;\n    }\n    context.strokeText(text, x, y);\n    if (applyOpacity) {\n      context.globalAlpha = currentGlobalAlpha;\n    }\n  }\n\n  // ---\n\n  drawToContext(\n    context: CanvasRenderingContext2D,\n    object: DisplayObject,\n    renderState: RenderState,\n    plugin: CanvasRendererPlugin,\n    runtime: GlobalRuntime,\n  ) {\n    this.render(\n      context,\n      object.parsedStyle as ParsedTextStyleProps,\n      object,\n      object.ownerDocument.defaultView.context,\n      plugin,\n      runtime,\n    );\n  }\n}\n","import { AbstractRendererPlugin, Shape } from '@antv/g-lite';\nimport type { PathGenerator } from '@antv/g-plugin-canvas-path-generator';\nimport { CanvasRendererPlugin } from './CanvasRendererPlugin';\nimport {\n  type StyleRenderer,\n  DefaultRenderer,\n  TextRenderer,\n  ImageRenderer,\n} from './shapes/styles';\nimport type { CanvasRendererPluginOptions } from './interfaces';\n\nexport * from './shapes/styles';\n\nexport class Plugin extends AbstractRendererPlugin<{\n  defaultStyleRendererFactory: Record<Shape, StyleRenderer>;\n  styleRendererFactory: Record<Shape, StyleRenderer>;\n  pathGeneratorFactory: Record<Shape, PathGenerator<any>>;\n}> {\n  name = 'canvas-renderer';\n\n  constructor(private options: Partial<CanvasRendererPluginOptions> = {}) {\n    super();\n  }\n\n  init(): void {\n    const canvasRendererPluginOptions: CanvasRendererPluginOptions = {\n      dirtyObjectNumThreshold: 500,\n      dirtyObjectRatioThreshold: 0.8,\n      ...this.options,\n    };\n\n    // @ts-ignore\n    const { imagePool } = this.context;\n\n    const defaultRenderer = new DefaultRenderer(imagePool);\n\n    const defaultStyleRendererFactory: Record<Shape, StyleRenderer> = {\n      [Shape.CIRCLE]: defaultRenderer,\n      [Shape.ELLIPSE]: defaultRenderer,\n      [Shape.RECT]: defaultRenderer,\n      [Shape.IMAGE]: new ImageRenderer(imagePool),\n      [Shape.TEXT]: new TextRenderer(imagePool),\n      [Shape.LINE]: defaultRenderer,\n      [Shape.POLYLINE]: defaultRenderer,\n      [Shape.POLYGON]: defaultRenderer,\n      [Shape.PATH]: defaultRenderer,\n      [Shape.GROUP]: undefined,\n      [Shape.HTML]: undefined,\n      [Shape.MESH]: undefined,\n      [Shape.FRAGMENT]: undefined,\n    };\n\n    this.context.defaultStyleRendererFactory = defaultStyleRendererFactory;\n    this.context.styleRendererFactory = defaultStyleRendererFactory;\n\n    this.addRenderingPlugin(\n      new CanvasRendererPlugin(canvasRendererPluginOptions),\n    );\n  }\n  destroy(): void {\n    this.removeAllRenderingPlugins();\n\n    delete this.context.defaultStyleRendererFactory;\n    delete this.context.styleRendererFactory;\n  }\n}\n"],"names":["_renderState","_classPrivateFieldLooseKey","CanvasRendererPlugin","canvasRendererPluginOptions","_classCallCheck","removedRBushNodeAABBs","renderQueue","Object","defineProperty","writable","value","restoreStack","prevObject","currentContext","Map","clearFullScreenLastFrame","clearFullScreen","vpMatrix","mat4","create","dprMatrix","tmpMat4","vec3a","vec3","vec3b","vec3c","vec3d","_createClass","key","apply","context","runtime","_this","_this$context","config","camera","renderingService","renderingContext","rBushRoot","pathGeneratorFactory","enableRenderingOptimization","renderer","getConfig","enableDirtyCheck","enableDirtyRectangleRendering","rBush","contextService","canvas","root","ownerDocument","defaultView","handleUnmounted","e","object","target","rBushNode","aabb","push","handleCulled","hooks","init","tap","tag","addEventListener","ElementEvent","UNMOUNTED","CULLED","dpr","getDPR","width","height","getContext","clearRect","background","destroy","removeEventListener","_classPrivateFieldLooseBase","beginFrame","_canvas$context$rende","_this$canvasRendererP","dirtyObjectNumThreshold","dirtyObjectRatioThreshold","_renderingService$get","getStats","total","rendered","ratio","renderingPlugins","isFirstTimeRenderingFinished","disableDirtyRectangleRendering","resetTransform","setTransform","renderByZIndex","stack","length","currentObject","pop","isVisible","isCulled","renderDisplayObjectOptimized","renderDisplayObject","objects","sortable","sorted","childNodes","i","endFrame","clear","fromScaling","multiply","getOrthoMatrix","save","restore","dirtyRenderBounds","safeMergeAABB","mergeDirtyAABBs","concat","_toConsumableArray","map","_ref","minX","minY","maxX","maxY","AABB","setMinMax","isEmpty","dirtyRect","convertAABB2Rect","x","y","tl","transformMat4","tr","bl","br","minx","Math","min","miny","maxx","max","maxy","ix","floor","iy","iwidth","ceil","iheight","beginPath","rect","clip","_config$renderer$getC","enableDirtyRectangleRenderingDebug","dispatchEvent","CustomEvent","CanvasEvent","DIRTY_RECTANGLE","dirtyObjects","searchDirtyObjects","sort","a","b","renderOrder","forEach","saveDirtyAABB","render","fillStyle","fillRect","canvasContext","renderState","nodeName","updateTransform","clipDraw","styleRenderer","styleRendererFactory","generatePath","clipPath","parsedStyle","exactEquals","getWorldTransform","applyWorldTransform","closePath","forceUpdateStyle","prevNodeName","Shape","TEXT","IMAGE","applyStyleToContext","LINE","PATH","POLYLINE","drawToContext","renderable","dirty","parent","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINS","applyAttributesToContext","_ref2","stroke","fill","opacity","lineDash","lineDashOffset","setLineDash","isNil","globalAlpha","Array","isArray","isNone","strokeStyle","attributes","getMin","getMax","renderBounds","getRenderBounds","add","dirtyRectangle","_dirtyRectangle$getMi","_dirtyRectangle$getMi2","_slicedToArray","_dirtyRectangle$getMa","_dirtyRectangle$getMa2","rBushNodes","search","_ref3","displayObject","update","center","halfExtents","matrix","copy","getLocalTransform","merged","_len","arguments","aabbs","_key","getPattern","pattern","plugin","imagePool","$offscreenCanvas","image","_parsedStyle","offscreenCanvas","offscreenCanvasCreator","getOrCreateCanvas","offscreenCanvasContext","getOrCreateContext","canvasPattern","getOrCreatePatternSync","getGeometryBounds","dirtify","getColor","parsedColor","color","type","GradientType","LinearGradient","RadialGradient","bounds","getOrCreateGradient","_objectSpread","SHADOW_NUMBER_STYLE","STROKE_STYLE","DEFAULT_STYLE","shadowBlur","shadowOffsetX","shadowOffsetY","shadowColor","filter","globalCompositeOperation","strokeOpacity","lineWidth","lineCap","lineJoin","miterLimit","fillOpacity","defaultParsedStyle","updateContextIfNotHitCache","cache","prevValue","has","get","set","OptimizedDefaultRenderer","applyCommonStyleToContext","forceUpdate","prevStyle","style","blend","applyStrokeFillStyleToContext","_style$lineWidth","hasFill","hasStroke","styleName","applyShadowAndFilterStyleToContext","hasShadow","toString","clearShadowAndFilterStyleForContext","hasFilter","onlyClearShadowFilter","undefined","oldFilter","indexOf","replace","trim","fillToContext","_object$parsedStyle","fillRule","resetStyle","gradient","_resetStyle","isPattern","strokeToContext","_this2","_resetStyle2","_resetStyle3","_style$fill","_style$opacity","_style$fillOpacity","_style$strokeOpacity","_style$lineWidth2","isInnerShadow","shadowType","isFillTransparent","alpha","shouldDrawShadowWithStroke","originGlobalAlpha","updateOpacity","clearShadowAndFilter","prevOpacity","originBlend","DefaultRenderer","_OptimizedDefaultRend","_callSuper","_inherits","_parsedStyle$opacity","_parsedStyle$fillOpac","_parsedStyle$strokeOp","_parsedStyle$lineWidt","setShadowAndFilter","applyFill","applyStroke","skipFill","skipStroke","calculateOverlapRect","rect1","rect2","_rect","x1","y1","w1","h1","_rect2","x2","y2","w2","h2","overlapLeft","overlapTop","overlapRight","overlapBottom","transformRect","ImageRenderer","_DefaultRenderer","renderDownSampled","data","src","imageCache","downSampled","createDownSampledImage","then","res","drawImage","drawRect","renderTile","imageRect","originalSize","size","_context$getTransform","getTransform","c","d","f","gridSize","createImageTiles","scaleToOrigin","scaledTileSize","tileSize","startTileX","endTileX","startTileY","endTileY","tileY","tileX","item","tiles","tileRect","_parsedStyle$x","_parsedStyle$y","getImageSync","img","iw","ih","_object$ownerDocument","getContextService","getDomElement","viewWidth","viewHeight","currentTransform","transformMatrix","fromValues","enableLargeImageOptimization","renderFull","sizeOfOrigin","downSamplingRate","ImagePool","isSupportTile","_unused","TextRenderer","getBounds","_parsedStyle$textAlig","textAlign","_parsedStyle$textBase","textBaseline","_parsedStyle$lineJoin","_parsedStyle$miterLim","_parsedStyle$letterSp","letterSpacing","metrics","dx","dy","font","lines","lineHeight","lineMetrics","formattedTextBaseline","linePositionY","offsetX","linePositionX","drawLetterSpacing","text","isStroke","strokeText","fillText","currentTextAlign","currentPosition","stringArray","from","previousWidth","measureText","currentWidth","currentChar","substring","currentGlobalAlpha","applyOpacity","Plugin","_AbstractRendererPlug","options","name","_defaultStyleRenderer","defaultRenderer","defaultStyleRendererFactory","_defineProperty","CIRCLE","ELLIPSE","RECT","POLYGON","GROUP","HTML","MESH","FRAGMENT","addRenderingPlugin","removeAllRenderingPlugins","AbstractRendererPlugin"],"mappings":"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"}