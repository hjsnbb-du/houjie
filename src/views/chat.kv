#:kivy 2.2.1

<MessageBubble@BoxLayout>:
    orientation: 'vertical'
    padding: '12dp'
    spacing: '4dp'
    size_hint: None, None
    size: self.minimum_size
    canvas.before:
        Color:
            rgba: (0.9, 0.9, 1, 1) if self.message_type == 'user' else (0.95, 0.95, 0.95, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [12]
        Color:
            rgba: (0.8, 0.8, 0.95, 1) if self.message_type == 'user' else (0.9, 0.9, 0.9, 1)
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, 12]
            width: 1
            
    Label:
        text: root.message
        color: 0.2, 0.2, 0.2, 1
        font_size: '15sp'
        text_size: self.width, None
        size_hint: 1, None
        height: self.texture_size[1]
        halign: 'left'
        markup: True
        
    Label:
        text: root.timestamp
        color: 0.5, 0.5, 0.5, 1
        font_size: '12sp'
        size_hint: 1, None
        height: '20dp'
        text_size: self.size
        halign: 'right'
        valign: 'middle'
    
    BoxLayout:
        orientation: 'vertical'
        size_hint: None, None
        size: self.minimum_size
        padding: '4dp'
        
        Label:
            id: content
            text: root.message
            size_hint: None, None
            size: self.texture_size
            padding: '4dp', '4dp'
            markup: True
            color: 0.2, 0.2, 0.2, 1
            text_size: self.size
            halign: 'left'

        Label:
            id: timestamp
            text: root.timestamp
            font_size: '12sp'
            size_hint: None, None
            size: self.texture_size
            halign: 'right'
            color: 0.5, 0.5, 0.5, 1

<ChatScreen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: '8dp'
        canvas.before:
            Color:
                rgba: 0.98, 0.98, 0.98, 1
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout:
            size_hint_y: None
            height: '56dp'
            padding: ['8dp', '4dp']
            spacing: '8dp'
            canvas.before:
                Color:
                    rgba: 0.95, 0.95, 0.95, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            Button:
                text: '\u2190'  # Left arrow
                font_size: '20sp'
                size_hint_x: None
                width: '48dp'
                on_release: root.go_back()
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: 0.2, 0.2, 0.2, 1

            Label:
                text: 'Chat'
                font_size: '18sp'
                color: 0.2, 0.2, 0.2, 1
                bold: True
                size_hint_x: None
                width: '100dp'
                text_size: self.size
                halign: 'left'
                valign: 'center'

            Widget:
                size_hint_x: 0.7

            Button:
                text: '\u2699'  # Gear icon
                font_size: '20sp'
                size_hint_x: None
                width: '48dp'
                on_release: root.show_settings()
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: 0.2, 0.2, 0.2, 1

        ScrollView:
            id: chat_scroll
            do_scroll_x: False
            bar_width: '5dp'
            bar_color: 0.7, 0.7, 0.7, 0.8
            bar_inactive_color: 0.7, 0.7, 0.7, 0.4
            effect_cls: 'ScrollEffect'
            
            BoxLayout:
                id: message_list
                orientation: 'vertical'
                spacing: '8dp'
                size_hint_y: None
                height: self.minimum_height
                padding: '8dp'

        BoxLayout:
            size_hint_y: None
            height: '64dp'
            padding: '8dp'
            spacing: '8dp'
            canvas.before:
                Color:
                    rgba: 0.95, 0.95, 0.95, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            BoxLayout:
                size_hint_x: 0.85
                canvas.before:
                    Color:
                        rgba: 0.98, 0.98, 0.98, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [5]
                TextInput:
                    id: message_input
                    hint_text: "Type your message..."
                    multiline: False
                    padding: '10dp'
                    background_color: 0, 0, 0, 0
                    cursor_color: 0.3, 0.3, 0.3, 1
                    foreground_color: 0.2, 0.2, 0.2, 1
                    on_text_validate: root.send_message()

            Button:
                text: '\u27A4'  # Heavy arrow pointing right
                font_size: '20sp'
                size_hint_x: 0.15
                background_normal: ''
                background_color: 0.2, 0.7, 0.3, 1
                color: 1, 1, 1, 1
                on_release: root.send_message()
                canvas.before:
                    Color:
                        rgba: 0.1, 0.6, 0.2, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [5]
